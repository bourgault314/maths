<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Glisse-nombres (décimaux)</title>
<style>
  :root {
    --gap: 6px;
    --cell: 60px;
    --headH: 36px;
    --primary: #4f46e5; /* Indigo 600 */
    --primary-hover: #4338ca;
    --bg-page: #f3f4f6;
    --bg-card: #ffffff;
    --text-main: #1f2937;
    --border-color: #e5e7eb;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  html { -webkit-text-size-adjust: 100%; }

  body {
    margin: 0;
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: clamp(10px, 3vw, 24px);
    -webkit-font-smoothing: antialiased;
  }

  .app {
    width: min(1100px, 100%);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* --- CARD STYLES --- */
  .card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
  }

  /* --- HEADER & CONTROLS --- */
  .header-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }

  h1 {
    margin: 0;
    font-weight: 800;
    font-size: clamp(20px, 4vw, 28px);
    color: #111827;
    text-align: center;
  }

  /* Main Action Bar (Movement) */
  .actions-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 12px;
    width: 100%;
  }

  .btn-action {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    font-size: clamp(18px, 3vw, 22px);
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.1s, background-color 0.2s;
    box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
    min-width: 140px;
  }
  .btn-action:active { transform: translateY(1px); box-shadow: none; }
  .btn-action:hover { background-color: var(--primary-hover); }

  .btn-reset {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
    padding: 10px 16px;
    border-radius: 10px;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .btn-reset:hover { background: #e5e7eb; }
  
  /* Status Display */
  #status-pill {
    background: #e0e7ff;
    color: var(--primary);
    padding: 6px 12px;
    border-radius: 99px;
    font-weight: 700;
    font-size: 14px;
    margin-top: -8px; /* Tweak visual spacing */
    min-width: 60px;
    text-align: center;
  }

  /* --- SETTINGS BAR (Secondary controls) --- */
  .settings-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    padding-top: 12px;
    border-top: 1px solid #f3f4f6;
    width: 100%;
  }

  .btn-secondary {
    background: transparent;
    border: 1px solid #d1d5db;
    color: #4b5563;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-secondary:hover { background: #f9fafb; border-color: #9ca3af; }
  .btn-secondary.active {
    background: #ecfccb; /* Light lime/green for active toggles */
    color: #365314;
    border-color: #84cc16;
  }

  /* Segmented Control for Zeros */
  .seg-control {
    display: flex;
    background: #f3f4f6;
    padding: 4px;
    border-radius: 10px;
    gap: 2px;
  }
  .seg-btn {
    border: none;
    background: transparent;
    padding: 6px 12px;
    border-radius: 7px;
    font-size: 13px;
    font-weight: 600;
    color: #6b7280;
    cursor: pointer;
  }
  .seg-btn.active {
    background: white;
    color: var(--primary);
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  /* --- GRID AREA --- */
  .grid-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 12px; /* Scrollbar space */
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(12, var(--cell));
    gap: var(--gap);
    justify-content: center;
    min-width: calc(12 * var(--cell) + 11 * var(--gap) + 12px);
    margin: 0 auto;
  }

  /* Headers */
  .head {
    height: var(--headH);
    text-align: center;
    background: #e5e7eb;
    color: #374151;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    font-size: 11px;
    line-height: 1.1;
    font-weight: 700;
    padding: 2px;
  }
  .head .lbl { display: flex; flex-direction: column; }
  
  /* Cells */
  .cell {
    height: var(--cell);
    background: #fff;
    border: 2px solid #9ca3af;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .cell:focus-within { border-color: var(--primary); }

  .cell.comma {
    background: #dbeafe; /* Light blue */
    border-color: #2563eb;
    border-width: 0;
  }
  .cell.comma span {
    font-size: clamp(24px, calc(var(--cell)*0.5), 32px);
    font-weight: 900;
    color: #2563eb;
    margin-top: 10px; /* Aligne visuellement la virgule vers le bas */
  }

  /* Inputs */
  .digit {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    text-align: center;
    font-family: inherit;
    font-weight: 800;
    font-size: clamp(20px, calc(var(--cell)*0.45), 32px);
    color: #111827;
    outline: none;
    padding: 0;
    margin: 0;
  }
  .digit::placeholder { color: #d1d5db; }

  /* Ghost Zeros */
  .ghost {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: clamp(20px, calc(var(--cell)*0.45), 32px);
    color: #9ca3af; /* Gris clair pour différencier */
    pointer-events: none;
    background: rgba(255,255,255,0.8);
  }

  /* Responsive Adjustments */
  @media (max-width: 600px) {
    .actions-bar { gap: 8px; }
    .btn-action { padding: 10px 16px; font-size: 16px; flex: 1; }
    .btn-reset { order: 3; width: 100%; justify-content: center; margin-top: 4px; }
    .settings-bar { flex-direction: column; align-items: center; }
  }
</style>
</head>
<body>

<main class="app" id="app">
  
  <!-- CONTROLS CARD -->
  <section class="card header-card">
    <h1>Glisse-nombres</h1>
    
    <div class="actions-bar">
      <button class="btn-action" id="times10" title="Décaler les chiffres vers la gauche">
        <span>←</span> ×10
      </button>
      
      <div id="status-pill">×1</div>

      <button class="btn-action" id="div10" title="Décaler les chiffres vers la droite">
        ÷10 <span>→</span>
      </button>

      <button class="btn-reset" id="resetBtn" type="button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        Réinitialiser
      </button>
    </div>

    <div class="settings-bar">
      <!-- Segmented Control for Zeros -->
      <div class="seg-control" id="zerosSeg" role="group" aria-label="Affichage des zéros">
        <button data-mode="none" class="seg-btn active" type="button">Sans zéros</button>
        <button data-mode="needed" class="seg-btn" type="button">Zéros utiles</button>
        <button data-mode="all" class="seg-btn" type="button">Tous les zéros</button>
      </div>

      <button class="btn-secondary" id="exitZerosBtn" type="button" title="Afficher les zéros qui sortent du tableau">
        Gestion de la sortie
      </button>
      <button class="btn-secondary" id="toggleCompact" type="button" title="Abréger les libellés">
        Titres compacts
      </button>
    </div>
  </section>

  <!-- GRID CARD -->
  <section class="card" style="padding: 10px 0;">
    <div class="grid-container">
      <div class="grid" id="grid">
        <!-- HEADERS -->
        <div class="head" data-col="0"><div class="lbl"><span>Centaines</span><span>de milliers</span></div></div>
        <div class="head" data-col="1"><div class="lbl"><span>Dizaines</span><span>de milliers</span></div></div>
        <div class="head" data-col="2"><div class="lbl"><span>Milliers</span></div></div>
        <div class="head" data-col="3"><div class="lbl"><span>Centaines</span></div></div>
        <div class="head" data-col="4"><div class="lbl"><span>Dizaines</span></div></div>
        <div class="head" data-col="5"><div class="lbl"><span>Unités</span></div></div>
        <div class="head" data-col="6"><div class="lbl"><span>,</span></div></div>
        <div class="head" data-col="7"><div class="lbl"><span>Dixièmes</span></div></div>
        <div class="head" data-col="8"><div class="lbl"><span>Centièmes</span></div></div>
        <div class="head" data-col="9"><div class="lbl"><span>Millièmes</span></div></div>
        <div class="head" data-col="10"><div class="lbl"><span>Dix</span><span>millièmes</span></div></div>
        <div class="head" data-col="11"><div class="lbl"><span>Cent</span><span>millièmes</span></div></div>

        <!-- CELLS -->
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c00" aria-label="Centaines de milliers" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c0"  aria-label="Dizaines de milliers" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c1"  aria-label="Milliers" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c2"  aria-label="Centaines" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c3"  aria-label="Dizaines" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c4"  aria-label="Unités" /></div>
        <div class="cell comma" aria-hidden="true"><span>,</span></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c6"  aria-label="Dixièmes" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c7"  aria-label="Centièmes" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c8"  aria-label="Millièmes" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c9"  aria-label="Dix millièmes" /></div>
        <div class="cell"><input class="digit" maxlength="1" inputmode="numeric" id="c10" aria-label="Cent millièmes" /></div>
      </div>
    </div>
  </section>

</main>

<script>
(() => {
  // CONFIGURATION DU TABLEAU
  const ids=["c00","c0","c1","c2","c3","c4",null,"c6","c7","c8","c9","c10"];
  const INT=[0,1,2,3,4,5];  // indices entiers
  const DEC=[7,8,9,10,11];  // indices décimales
  const UNITS=5;
  const COMMA=6;
  const order=[0,1,2,3,4,5,7,8,9,10,11]; // indices logiques sans la virgule

  // DOM ELEMENTS
  const app=document.getElementById('app');
  const grid=document.getElementById('grid');
  const zerosSeg=document.getElementById('zerosSeg');
  const resetBtn=document.getElementById('resetBtn');
  const times10=document.getElementById('times10');
  const div10=document.getElementById('div10');
  const status=document.getElementById('status-pill');
  const toggleCompact=document.getElementById('toggleCompact');
  const exitZerosBtn=document.getElementById('exitZerosBtn');

  const inputs=order.map(i=>document.getElementById(ids[i]));

  // STATE
  let zeroMode='none'; // 'none' | 'needed' | 'all'
  let exp10=0;         // cumul ×10/÷10
  let exitZeros=false; // afficher des zéros fantômes du côté du débordement
  const leftStack=[];  // ce qui sort à gauche (×10)
  const rightStack=[]; // ce qui sort à droite (÷10)
  let overflowSide=null; // 'left' | 'right' | null
  let forceCompact=false;

  // LABELS
  const labelsNormal = [
    ['Centaines','de milliers'], ['Dizaines','de milliers'], ['Milliers'], ['Centaines'], ['Dizaines'], ['Unités'],
    [','],
    ['Dixièmes'], ['Centièmes'], ['Millièmes'], ['Dix','millièmes'], ['Cent','millièmes']
  ];
  const labelsCompact = [
    ['Cent.','de mill.'], ['Diz.','de mill.'], ['Milliers'], ['Cent.'], ['Diz.'], ['Unités'],
    [','],
    ['Dixièmes'], ['Centièmes'], ['Millièmes'], ['Dix','mill.'], ['Cent','mill.']
  ];

  function renderLabels(useCompact){
    document.querySelectorAll('.head').forEach((head, idx)=>{
      const lbl=head.querySelector('.lbl');
      const set=useCompact?labelsCompact:labelsNormal;
      const parts=set[idx]||[''];
      lbl.innerHTML=parts.map(t=>`<span>${t}</span>`).join('');
    });
  }

  function applyCompactAutoOrForced(){
    if(forceCompact){ renderLabels(true); return; }
    const w=Math.min(window.innerWidth, document.documentElement.clientWidth || window.innerWidth);
    renderLabels(w < 500); // Seuil un peu plus large
  }

  // RESPONSIVE SIZING
  function calcCell(){
    const root=document.documentElement;
    // On calcule l'espace dispo moins le padding
    const containerW = app.clientWidth; 
    // Marge de sécurité (padding + borders)
    const margin = 32; 
    const gap = 6;
    const nbCols = 12;
    
    // Calcul de la taille max possible
    let c = Math.floor( (containerW - margin - (nbCols-1)*gap) / nbCols );
    
    // Bornes
    c = Math.max(34, Math.min(70, c));

    root.style.setProperty('--cell', c+'px');
    root.style.setProperty('--headH', Math.max(32, Math.round(c*0.6))+'px');
  }

  function initLayoutWatchers(){
    calcCell();
    window.addEventListener('resize', () => { calcCell(); applyCompactAutoOrForced(); });
    // Délai pour orientation change sur mobile
    window.addEventListener('orientationchange', ()=>setTimeout(()=> { calcCell(); applyCompactAutoOrForced(); }, 100));
    applyCompactAutoOrForced();
  }

  // UTILS
  function sanitizeToDigit(v){ const m=(v||'').toString().match(/[0-9]/); return m?m[0]:''; }
  function indexOfInput(el){ return order.findIndex(i=>ids[i]===el.id); }
  function focusMove(delta){
    const active=document.activeElement; 
    if(!active||!active.classList.contains('digit')) return;
    let idx=indexOfInput(active); if(idx<0) return;
    idx=Math.min(order.length-1, Math.max(0, idx+delta));
    inputs[idx].focus(); inputs[idx].select();
  }
  function readRaw(){ const a=new Array(ids.length).fill(''); for(const i of order){ a[i]=document.getElementById(ids[i]).value; } return a; }
  function writeRaw(arr){ for(const i of order){ document.getElementById(ids[i]).value=arr[i]||''; } }
  function clearGhosts(){ grid.querySelectorAll('.cell .ghost').forEach(g=>g.remove()); }

  // LOGIC: ZEROS
  function applyZeroMode(){
    clearGhosts();
    const raw=readRaw();
    const hasInt=INT.some(i=>raw[i]!=='' );
    const hasDec=DEC.some(i=>raw[i]!=='' );
    
    function addGhost(i){
      const cell=document.getElementById(ids[i]).parentElement;
      if(!cell.querySelector('.ghost')){
        const g=document.createElement('div'); g.className='ghost'; g.textContent='0'; cell.appendChild(g);
      }
    }

    if(zeroMode==='all'){
      for(const i of INT){ if(raw[i]==='') addGhost(i); }
      for(const i of DEC){ if(raw[i]==='') addGhost(i); }
    } else if(zeroMode==='needed'){
      // Partie décimale : zéros à droite jusqu'au dernier chiffre
      if(hasDec){ 
        // On ne met des zéros que ENTRE la virgule et le dernier chiffre non nul, ou pour combler
        // Simplification pédagogique : afficher tous les 0 à gauche du dernier chiffre décimal
        // Non, "needed" pour décimale = 0.50 -> le 0 de droite est inutile. 0.05 -> le 0 de gauche est utile.
        // Algo : on part de la gauche (dixièmes), on remplit les trous jusqu'au dernier chiffre rempli
        let lastFilledDec = -1;
        for(let k=DEC.length-1; k>=0; k--){ if(raw[DEC[k]]!=='') { lastFilledDec=k; break; } }
        if(lastFilledDec !== -1) {
           for(let k=0; k<lastFilledDec; k++){
             if(raw[DEC[k]]==='') addGhost(DEC[k]);
           }
        }
      }
      
      // Partie entière : zéros utiles = unités si vide, et trous entre chiffres
      if(hasInt){
        let firstFilledInt = -1;
        for(let k=0; k<INT.length; k++){ if(raw[INT[k]]!=='') { firstFilledInt=k; break; } }
        
        // Combler les trous entre le premier chiffre et les unités
        for(let k=firstFilledInt+1; k<INT.length; k++){
            if(raw[INT[k]]==='') addGhost(INT[k]);
        }
      } else {
        // Si aucun entier mais qu'il y a des décimales, on met un 0 aux unités
        if(hasDec) addGhost(UNITS);
      }
    }
  }

  function ensureExitZeros(){
    if(!exitZeros || !overflowSide) return;
    const raw=readRaw();
    function addGhost(i){
      const cell=document.getElementById(ids[i]).parentElement;
      if(!cell.querySelector('.ghost')){
        const g=document.createElement('div'); g.className='ghost'; g.textContent='0'; cell.appendChild(g);
      }
    }
    if(overflowSide==='left'){ for(const i of INT){ if(raw[i]==='') addGhost(i); } }
    if(overflowSide==='right'){ for(const i of DEC){ if(raw[i]==='') addGhost(i); } }
  }

  // LOGIC: SHIFT
  function shift(dir){
    const prev=readRaw();
    const next=prev.slice();
    const orderLinear=[0,1,2,3,4,5,7,8,9,10,11]; 
    const first=orderLinear[0];
    const last =orderLinear[orderLinear.length-1];

    if(dir==='left'){ // ×10
      exp10++;
      const lost=prev[first]; if(lost!=='') leftStack.push(lost);
      for(const i of orderLinear){
        const nxt=(i+1===COMMA)?COMMA+1:(i+1);
        next[i]=(nxt<ids.length)?prev[nxt]:''; 
      }
      if(rightStack.length){ next[last]=rightStack.pop(); }
    } else { // ÷10
      exp10--;
      const lost=prev[last]; if(lost!=='') rightStack.push(lost);
      for(let k=orderLinear.length-1;k>=0;k--){
        const i=orderLinear[k];
        const prv=(i-1===COMMA)?UNITS:(i-1);
        next[i]=(prv>=0)?prev[prv]:''; 
      }
      if(leftStack.length){ next[first]=leftStack.pop(); }
    }

    if(overflowSide===null){
      if(leftStack.length>0 && rightStack.length===0) overflowSide='left';
      else if(rightStack.length>0 && leftStack.length===0) overflowSide='right';
    }
    if(leftStack.length===0 && rightStack.length===0) overflowSide=null;

    writeRaw(next);
    applyZeroMode();
    ensureExitZeros();
    updateStatus();
  }

  function resetAll(){
    inputs.forEach(i=>i.value='');
    clearGhosts();
    zeroMode='none';
    zerosSeg.querySelectorAll('.seg-btn').forEach(x=>x.classList.remove('active'));
    zerosSeg.querySelector('[data-mode="none"]').classList.add('active');
    
    exitZeros=false;
    exitZerosBtn.classList.remove('active');
    
    exp10=0; overflowSide=null; leftStack.length=0; rightStack.length=0;
    updateStatus();
    inputs[5].focus(); // Focus Unités
  }

  function updateStatus(){
    let label='×1';
    if(exp10!==0){
      const n=Math.abs(exp10);
      if(n<=6) {
        label = exp10>0 ? '×'+(10**n).toLocaleString() : '÷'+(10**n).toLocaleString();
      } else {
        label = exp10>0 ? '×10^'+n : '÷10^'+n;
      }
    }
    status.textContent=label;
  }

  // EVENT LISTENERS
  inputs.forEach(inp=>{
    inp.addEventListener('focus',()=>{ inp.setAttribute('autocomplete','off'); });
    inp.addEventListener('beforeinput',e=>{
      if(e.inputType==='insertText' || e.inputType==='insertFromPaste'){
        const ch=(e.data||'').replace(/[^0-9]/g,''); if(ch==='') e.preventDefault();
      }
    });
    inp.addEventListener('input',e=>{
      const v=sanitizeToDigit(e.target.value); e.target.value=v;
      if(v!=='') focusMove(+1);
      applyZeroMode(); ensureExitZeros();
    });
    inp.addEventListener('keydown',e=>{
      if(e.key==='ArrowLeft'){ e.preventDefault(); focusMove(-1); }
      if(e.key==='ArrowRight'){ e.preventDefault(); focusMove(+1); }
      if(e.key==='Backspace' && e.target.value===''){ e.preventDefault(); focusMove(-1); }
    });
  });

  zerosSeg.addEventListener('click',e=>{
    const b=e.target.closest('.seg-btn'); if(!b) return;
    zerosSeg.querySelectorAll('.seg-btn').forEach(x=>x.classList.remove('active'));
    b.classList.add('active'); zeroMode=b.dataset.mode;
    applyZeroMode(); ensureExitZeros();
  });

  resetBtn.addEventListener('click',resetAll);
  times10.addEventListener('click',()=>shift('left'));
  div10.addEventListener('click',()=>shift('right'));

  toggleCompact.addEventListener('click', ()=>{
    forceCompact=!forceCompact;
    toggleCompact.classList.toggle('active', forceCompact);
    applyCompactAutoOrForced();
  });

  exitZerosBtn.addEventListener('click', ()=>{
    exitZeros=!exitZeros;
    exitZerosBtn.classList.toggle('active', exitZeros);
    ensureExitZeros();
  });

  // START
  initLayoutWatchers();
  updateStatus();
})();
</script>
</body>
</html>
