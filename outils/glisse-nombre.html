<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Glisse-nombre â€“ Ã—Ã· 10/100/1000</title>
  <link rel="stylesheet" href="/assets/style.css" />
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <a href="/outils/">â¬… Outils</a>
        <span>ðŸ”¢ Glisse-nombre</span>
      </nav>
    </div>
  </header>
  <main>
    <div class="container card">
      <h1>Glisse-nombre</h1>
      <p>Multiplie ou divise par 10, 100, 1000 (sans erreurs dâ€™arrondi) en dÃ©plaÃ§ant la virgule.</p>

      <div class="grid">
        <div>
          <label for="entrÃ©e">Nombre</label>
          <input id="entrÃ©e" type="text" inputmode="decimal" placeholder="ex. 3,5 ou 3.5" />
        </div>
        <div>
          <label for="opÃ©ration">OpÃ©ration</label>
          <select id="opÃ©ration">
            <option value="mul10">Ã— 10</option>
            <option value="mul100">Ã— 100</option>
            <option value="mul1000">Ã— 1000</option>
            <option value="div10">Ã· 10</option>
            <option value="div100">Ã· 100</option>
            <option value="div1000">Ã· 1000</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="calculer">Calculer</button>
        <button id="effacer" type="button">Effacer</button>
      </div>

      <p id="sortie" class="result" style="margin-top:16px"></p>
      <p id="explication" class="small"></p>

      <hr />
      <h2>Exemples</h2>
      <div class="row">
        <button class="ex" data-v="3,5" data-op="mul10">3,5 Ã— 10</button>
        <button class="ex" data-v="0,062" data-op="mul1000">0,062 Ã— 1000</button>
        <button class="ex" data-v="-12,03" data-op="div100">âˆ’12,03 Ã· 100</button>
      </div>
    </div>
  </main>

  <script>
  function normalizeInput(str) {
    str = (str || '').trim().replace(/\s+/g, '');
    str = str.replace(',', '.');
    if (!/^[-+]?\d*(?:\.\d*)?$/.test(str) || str === '' || str === '+' || str === '-') return null;
    let sign = '';
    if (str[0] === '-' || str[0] === '+') { sign = str[0] === '-' ? '-' : ''; str = str.slice(1); }
    if (str === '' || str === '.') str = '0';
    if (str.startsWith('.')) str = '0' + str;
    let [intPart, fracPart=''] = str.split('.');
    intPart = intPart.replace(/^0+(?=\d)/, '');
    fracPart = fracPart.replace(/0+$/, '');
    if (fracPart.length === 0) return sign + (intPart === '' ? '0' : intPart);
    return sign + (intPart === '' ? '0' : intPart) + '.' + fracPart;
  }
  function shiftDecimal(numStr, steps) {
    let sign = '';
    if (numStr.startsWith('-')) { sign = '-'; numStr = numStr.slice(1); }
    let [intPart, fracPart=''] = numStr.split('.');
    const digits = intPart + fracPart;
    let dotIndex = intPart.length;
    let newIndex = dotIndex + steps;
    if (newIndex <= 0) {
      return sign + '0.' + '0'.repeat(-newIndex) + (digits.replace(/^0+/, '') || '0');
    }
    if (newIndex >= digits.length) {
      return sign + digits + '0'.repeat(newIndex - digits.length);
    }
    const left = digits.slice(0, newIndex);
    const right = digits.slice(0+newIndex);
    let res = sign + left + (right ? '.' + right : '');
    if (res.includes('.')) {
      res = res.replace(/\.?0+$/, '').replace(/^(-?)\./, '$10.');
    }
    res = res.replace(/^-?0+(?=\d)/, (m)=>m.startsWith('-')?'-':'') ;
    return res;
  }
  function stepsFromOp(op) {
    switch(op) {
      case 'mul10': return 1; case 'mul100': return 2; case 'mul1000': return 3;
      case 'div10': return -1; case 'div100': return -2; case 'div1000': return -3;
      default: return 0;
    }
  }
  function formatFr(x) { return x.replace('.', ','); }
  const entrÃ©e = document.getElementById('entrÃ©e');
  const opÃ©ration = document.getElementById('opÃ©ration');
  const sortie = document.getElementById('sortie');
  const explication = document.getElementById('explication');
  function expliquer(op, steps) {
    const sens = steps > 0 ? 'droite' : 'gauche';
    const n = Math.abs(steps);
    const quoi = n===1 ? 'un rang' : (n===2?'deux rangs':'trois rangs');
    return (steps>0)
      ? `On multiplie par ${10**n} â‡’ on dÃ©place la virgule de ${quoi} vers la ${sens}.`
      : `On divise par ${10**n} â‡’ on dÃ©place la virgule de ${quoi} vers la ${sens}.`;
  }
  function calculer() {
    const norm = normalizeInput(entrÃ©e.value);
    if (norm === null) { sortie.textContent = 'âš ï¸ Nombre invalide'; explication.textContent = ''; return; }
    const s = stepsFromOp(opÃ©ration.value);
    const res = shiftDecimal(norm, s);
    sortie.textContent = formatFr(res);
    explication.textContent = expliquer(opÃ©ration.value, s);
  }
  document.getElementById('calculer').addEventListener('click', calculer);
  document.getElementById('effacer').addEventListener('click', ()=>{ entrÃ©e.value=''; sortie.textContent=''; explication.textContent=''; });
  document.querySelectorAll('.ex').forEach(b=> b.addEventListener('click', ()=>{ entrÃ©e.value=b.dataset.v; opÃ©ration.value=b.dataset.op; calculer(); }));
  </script>
</body>
</html>
