<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<title>Générateur PRO — Fractions</title>
<style>
  :root { --page-w: 297mm; --page-h: 210mm; }
  *{ box-sizing:border-box; }
  body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; }
  
  /* EN-TÊTE ET NOM FINAL */
  header{ 
      padding:10px 14px; 
      background:#111; 
      color:#fff; 
      font-size:14px; 
      display: flex;
      justify-content: space-between; 
      align-items: center;
      flex-shrink: 0; 
  }
  header #return-link {
      color: #ccc;
      text-decoration: none;
      font-weight: 500;
      margin-right: auto; 
  }
  header #return-link:hover {
      color: #fff;
      text-decoration: underline;
  }
  header span {
      flex-grow: 1;
      text-align: center;
      white-space: nowrap; 
  }
  header div {
      width: auto; 
      margin-left: auto; 
  }
  
  /* Correction du bug de défilement (hauteur main ajustée) */
  main{ 
      display:grid; 
      grid-template-columns: 360px 1fr; 
      gap:14px; 
      padding:14px; 
      height: calc(100vh - 46px); 
  }
  
  /* STYLE DES CONTRÔLES (Fixe la hauteur totale) */
  .controls { 
      height: 100%; 
      display: flex; 
      flex-direction: column; 
  }
  /* Correction de l'overflow pour le menu principal */
  #settings-scroll-area {
      flex-grow: 1; 
      overflow-y: auto; 
      padding-right: 8px; 
      padding-top: 10px; 
      -webkit-overflow-scrolling: touch; 
  }
  
  fieldset{ border:1px solid #ddd; border-radius:8px; margin:0 0 10px 0; }
  legend{ padding:0 6px; font-weight:600; }
  
  label{ 
      display:block; 
      font-size:13px; 
      margin: 0; 
      padding-top: 8px; 
      padding-bottom: 2px; 
      line-height: 1.2; 
  }

  .row{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .row > div {
      display: flex;
      flex-direction: column; 
  }
  
  input, select{ width:100%; padding:8px; font-size:14px; }

  .actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  button{ padding:9px 10px; font-weight:600; font-size:14px; cursor:pointer; }
  
  /* FIX UI: La zone d'aperçu prend la hauteur totale (alignée sur les contrôles) */
  .preview{ 
    background:#f6f7f9; 
    border:1px solid #e2e3e6; 
    border-radius:8px; 
    padding:4px; /* Rétablit l'espace gris autour */
    overflow:auto; 
    height: 100%; 
  }
  
  /* FIX CLÉ: Nouvelle mise en page des pages A4 (alignement top-left pour l'aperçu) */
  .page{ 
    width: var(--page-w); 
    height: var(--page-h); 
    background:white; 
    /* Espace minimal entre les pages */
    margin: 0 0 1mm 0; 
    position: relative; 
    border: 1px dashed #cfd6e3; 
    
    /* Zoom pour visualiser la page A4 entière */
    transform: scale(0.85); 
    transform-origin: top left;
  }
  
  @media print{
    header, .controls { display:none !important; }
    main{ display:block; padding:0; height:auto; } 
    .preview{ border:none; padding:0; height:auto; }
    /* Annulation du zoom et de la marge pour l'impression 1:1 */
    .page{ break-after: page; page-break-after: always; border:none; margin:0; transform: none; }
    @page { size: A4 landscape; margin: 0; }
  }
</style>
</head>
<body>
<header>
    <a href="https://bourgault314.github.io/maths/outils/" id="return-link">← Index des outils</a>
    <span>GÉNÉRATEUR PRO — FRACTIONS | Imprimer en Recto-Verso bord long</span>
    <div style="width: auto; margin-left: auto;"></div> 
</header>
<main>
  <section class="controls">
    <form id="form">
    
      <fieldset id="actions-fieldset">
        <legend>Actions</legend>
        <div class="actions">
          <button type="button" id="print">Imprimer / Export PDF</button>
        </div>
      </fieldset>

      <div id="settings-scroll-area">
          
          <fieldset>
            <legend>Dimensions</legend>
            <div class="row">
              <div>
                <label>Longueur bande (mm)</label>
                <input type="number" id="bandLen" step="0.1" value="210">
              </div>
              <div>
                <label>Hauteur de la bande (mm)</label>
                <input type="number" id="bandHeight" step="0.1" value="55">
              </div>
            </div>
            <div>
              <label>Écart vertical entre les bandes (mm)</label>
              <input type="number" id="gapV" step="0.1" value="7">
            </div>
          </fieldset>
    
          <fieldset>
            <legend>Décalages / Alignement (mm)</legend>
            <div class="row">
              <div>
                <label>Décalage horizontal RECTO</label>
                <input type="number" id="rectoOffX" step="0.1" value="-2">
              </div>
              <div>
                <label>Décalage vertical RECTO</label>
                <input type="number" id="rectoOffY" step="0.1" value="0">
              </div>
            </div>
            <div class="row">
              <div>
                <label>Décalage horizontal VERSO</label>
                <input type="number" id="offX" step="0.1" value="0">
              </div>
              <div>
                <label>Décalage vertical VERSO</label>
                <input type="number" id="offY" step="0.1" value="0">
              </div>
            </div>
          </fieldset>
    
          <fieldset>
            <legend>Style des bandes</legend>
            <div class="row">
              <div>
                <label>Épaisseur contour (mm)</label>
                <input type="number" id="frameW" step="0.01" value="0.10">
              </div>
              <div>
                <label>Épaisseur pointillés (mm)</label>
                <input type="number" id="dotW" step="0.01" value="0.10">
              </div>
            </div>
            <div class="row">
                <div>
                    <label>Bordures intérieures</label>
                    <select id="innerBorders">
                        <option value="visible" selected>Visibles</option>
                        <option value="hidden">Masquées (bandes vierges)</option>
                    </select>
                </div>
                <div>
                    <label>Style des fonds</label>
                    <select id="colorMode">
                        <option value="white" selected>Uniforme (Blanc)</option>
                        <option value="colored">Couleurs Pédagogiques</option>
                    </select>
                </div>
            </div>
            
            <div class="row">
              <div>
                <label>Taille de l'écriture (pt)</label>
                <input type="number" id="labelPt" step="1" value="12">
              </div>
              <div>
                <label>Pointillés (motif, ex: 3,3)</label>
                <input type="text" id="dash" value="3,3">
                <p style="font-size: 11px; margin: 5px 0 0;">(Mettre '0' ou vide pour un trait plein)</p>
              </div>
            </div>
          </fieldset>
          
          <fieldset>
            <legend>Ajustements fraction</legend>
            <div class="row">
              <div>
                <label>Espacement numérateur ↔ barre</label>
                <input type="number" id="gapTop" step="0.01" value="0.40">
              </div>
              <div>
                <label>Espacement dénominateur ↔ barre</label>
                <input type="number" id="gapBottom" step="0.01" value="0.60">
              </div>
            </div>
            <div class="row">
              <div>
                <label>Longueur barre (%)</label> <input type="number" id="barRatio" step="1" value="80">
              </div>
              <div>
                <label>Épaisseur barre (mm)</label> <input type="number" id="barW" step="0.01" value="0.10">
              </div>
            </div>
            
            <label>Contenu des parts (d>1)</label>
            <select id="textMode">
              <option value="numeric" selected>Écriture fractionnaire (1/2, 1/4)</option>
              <option value="decimal">Décimal (0,5, 0,25)</option>
              <option value="percentage">Pourcentage (X %)</option>
              <option value="minutes">Temps (X min)</option>
              <option value="letters">En lettres (Un demi, Un tiers...)</option>
              <option value="empty">Vide (pas de texte)</option>
            </select>
            
            <label>Orientation du texte (Tous les modes)</label>
            <select id="textOrientation">
              <option value="auto" selected>Automatique (Vertical pour En lettres, Horizontal sinon)</option>
              <option value="vertical">Vertical (90°)</option>
              <option value="horizontal">Horizontal (0°)</option>
            </select>

            <label>Contenu de la bande UNITÉ (d=1)</label>
            <select id="unitMode">
                <option value="custom" selected>Texte personnalisé (utilise champ ci-dessous)</option>
                <option value="one">1</option>
                <option value="one-on-one">1/1</option>
                <option value="percent">100 %</option>
                <option value="minutes">60 min</option>
            </select>
            <input type="text" id="customText" value="1 unité" placeholder="Ex: 1 unité" style="margin-top: 5px;">
            
            <div id="unitPartDisplayContainer">
                <label>Affichage des parts (d>1) avec unité</label>
                <select id="unitPartDisplay">
                    <option value="standalone" selected>Unité seule (ex: 1 u | 1/4)</option>
                    <option value="fractional">Unité fractionnée (ex: 1 u | 1/4 u)</option>
                </select>
            </div>

            <label>Dénominateurs (ex: 2,3,4,5,6,8,10)</label>
            <input type="text" id="denoms" value="2,3,4,5,6,8,10">
          </fieldset>
    
          <fieldset>
            <legend>Recto / Verso</legend>
            <div class="row">
              <div>
                <label>Mode</label>
                <select id="mode">
                  <option value="recto">Recto (fractions)</option>
                  <option value="verso">Verso (unités)</option>
                  <option value="interleaved">Intercalé (Unité + Fraction par d)</option>
                  <option value="recto-verso" selected>Recto-Verso consécutif (Fraction x2)</option>
                </select>
              </div>
              <div>
                <label>Inclure la bande unité ?</label> <select id="includeUnit"><option value="yes" selected>oui</option><option value="no">non</option></select>
              </div>
            </div>
          </fieldset>
          
      </div> </form>
  </section>

  <section class="preview" id="preview"></section>
</main>

<script>
const W = 297; // mm (A4 paysage)
const H = 210; // mm
function mm(v){ return v + "mm"; }

const denomToLetters = {
    1: "Une unité",
    2: "Un demi",
    3: "Un tiers",
    4: "Un quart",
    5: "Un cinquième",
    6: "Un sixième",
    7: "Un septième", 
    8: "Un huitième",
    9: "Un neuvième", 
    10: "Un dixième",
    11: "Un onzième", 
    12: "Un douzième", 
};

const denomColors = {
    1: '#fff', 2: '#ffb3b3', 3: '#6699ff', 4: '#b3ffc6', 5: '#ff9966', 
    6: '#e0b3ff', 7: '#99ccff', 8: '#ccff99', 9: '#ffccff', 10: '#ffffb3', 
    11: '#cc99ff', 12: '#99ffff',
};

/**
 * Extrait le suffixe d'unité du texte personnalisé (ex: "1 heure" -> "h")
 */
function getUnitySuffix(customText) {
    // Supprime "1" ou "1 " ou "1" en début de chaîne
    const suffix = customText.replace(/^1\s*/i, '').trim();
    if (suffix.length > 2 && suffix.toLowerCase().includes('unité')) return 'u';
    // Utiliser le suffixe tel quel (h, min, etc.)
    return suffix || 'u'; 
}


/**
 * Récupère le texte de la part fractionnaire (d>1) pour les modes non-numeric
 */
function getTextContent(d, textMode, unitPartDisplay, customText){
    const val = 1 / d;
    let partText = '';

    if (textMode === 'percentage') {
        let valStr = Number((val * 100).toFixed(2));
        partText = `${valStr} %`;
    } else if (textMode === 'minutes') {
        const minVal = val * 60;
        if (Number.isInteger(minVal)) {
             partText = `${minVal} min`;
        } else {
            partText = `${minVal.toFixed(1)} min`;
        }
    } else if (textMode === 'decimal') {
        // Remplacement du point par la virgule pour le format français
        partText = val.toFixed(3).replace(/\.?0+$/, '').replace('.', ','); 
    } else if (textMode === 'numeric') {
        return ''; 
    } else { 
        return '';
    }

    // Ajout de l'unité fractionnée si mode décimal et option activée
    const isDecimalFractional = (textMode === 'decimal' && unitPartDisplay === 'fractional');

    if (isDecimalFractional) {
        const unitySuffix = getUnitySuffix(customText); 
        return `${partText} ${unitySuffix}`;
    }

    return partText;
}

/**
 * Récupère le texte de la bande UNITE (d=1)
 */
function getUnityText(unitMode, customText) {
    if (unitMode === 'one') return '1'; 
    if (unitMode === 'one-on-one') return 'fraction'; // Signal pour utiliser fracSVG (1/1)
    if (unitMode === 'percent') return '100 %';
    if (unitMode === 'minutes') return '60 min';
    return customText; // 'custom' mode
}

/**
 * Détermine la rotation à appliquer au texte.
 */
function getRotation(textMode, textOrientation) {
    let rotation = 0;
    
    if (textOrientation === 'horizontal') {
        rotation = 0;
    } else if (textOrientation === 'vertical') {
        rotation = 90;
    } else { // auto
        if (textMode === 'letters') {
            rotation = 90; 
        } else {
            rotation = 0; 
        }
    }
    
    return rotation;
}

/**
 * Génère le groupe SVG pour une part de fraction (y compris la barre horizontale)
 */
function fracSVG(cx, cy, sizePt, d, gapTopRatio, gapBottomRatio, barRatio, barWmm, textMode, textOrientation, unitPartDisplay, customText, isUnitD1 = false){
  const g = document.createElementNS("http://www.w3.org/2000/svg","g");
  
  if(textMode === "empty" && !isUnitD1){
    return g; 
  }
  
  const sizePx = sizePt * 96/72;
  const gapTop = sizePx * (gapTopRatio ?? 0.40);
  const gapBottom = sizePx * (gapBottomRatio ?? 0.60);
  const barRatioFloat = (barRatio ?? 80);
  const halfBar = sizePx * (barRatioFloat / 200);

  const rotation = getRotation(textMode, textOrientation);
  const rotationTransform = rotation !== 0 ? `rotate(${rotation}, ${cx}, ${cy})` : '';

  // CAS 1: Mode Fractionnaire CLASSIQUE (Barre horizontale) ou 1/1
  const isClassicFraction = (textMode === 'numeric');
  
  if(isClassicFraction || isUnitD1){ 
    
    const num = isUnitD1 ? "1" : "1";
    const denom = isUnitD1 ? "1" : String(d);
    
    // Numérateur (toujours centré sur cx)
    const n = document.createElementNS("http://www.w3.org/2000/svg","text");
    n.setAttribute("x", cx); n.setAttribute("y", cy - gapTop);
    n.setAttribute("font-size", sizePt+"pt");
    n.setAttribute("text-anchor","middle");
    n.setAttribute("dominant-baseline","middle");
    n.textContent = num;
    
    // Dénominateur (toujours centré sur cx)
    const dd = document.createElementNS("http://www.w3.org/2000/svg","text");
    dd.setAttribute("x", cx); 
    dd.setAttribute("y", cy + gapBottom);
    dd.setAttribute("font-size", sizePt+"pt");
    dd.setAttribute("text-anchor", "middle"); // Centré
    dd.setAttribute("dominant-baseline","middle");
    dd.textContent = denom;

    // Barre de fraction
    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("x1", cx - halfBar);
    line.setAttribute("x2", cx + halfBar);
    line.setAttribute("y1", cy);
    line.setAttribute("y2", cy);
    line.setAttribute("stroke","black");
    line.setAttribute("stroke-width", mm(barWmm ?? 0.10));

    g.appendChild(n); 
    g.appendChild(dd); 
    g.appendChild(line);

    // L'unité doit être alignée sur la barre de fraction (cy) et positionnée à droite.
    if(textMode === 'numeric' && unitPartDisplay === 'fractional' && !isUnitD1){
        const unitySuffix = getUnitySuffix(customText); 
        
        // Calculer l'offset à droite du num/denom centrés.
        const barWidth = sizePx * (barRatioFloat / 100);
        const startX = cx + barWidth/2 + (sizePt * 0.2); // 0.2 pt d'espace
        
        // Ajout du suffixe d'unité
        const uText = document.createElementNS("http://www.w3.org/2000/svg","text");
        uText.setAttribute("x", startX); 
        uText.setAttribute("y", cy); // Alignement vertical sur la barre de fraction
        uText.setAttribute("font-size", sizePt+"pt");
        uText.setAttribute("text-anchor","start"); 
        uText.setAttribute("dominant-baseline","middle"); // Important pour l'alignement sur cy
        uText.textContent = unitySuffix;
        g.appendChild(uText);
    }
    
    if(rotationTransform) g.setAttribute("transform", rotationTransform);

  } else { 
    // CAS 2: Modes Texte Simple (letters, decimal, percentage, minutes, etc.)
    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x", cx); 
    t.setAttribute("y", cy); 
    t.setAttribute("font-size", sizePt+"pt");
    t.setAttribute("text-anchor","middle");
    t.setAttribute("dominant-baseline","middle");
    
    if (textMode === "letters") {
        t.textContent = denomToLetters[d] || ("1/"+d);
    } else {
        t.textContent = getTextContent(d, textMode, unitPartDisplay, customText);
    }
    
    if(rotationTransform) t.setAttribute("transform", rotationTransform);
    g.appendChild(t);
  }

  return g;
}

function drawPage({bandLen, bandHeight, gapV, labelPt, dash, frameW, dotW, gapTop, gapBottom, barRatio, barW, denom, unity, rectoOffX, rectoOffY, versoOff, textMode, textOrientation, colorMode, innerBorders, unitMode, customText, unitPartDisplay}){
  const page = document.createElement("div");
  page.className = "page";

  const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
  svg.setAttribute("xmlns","http://www.w3.org/2000/svg");
  svg.setAttribute("width", mm(W)); svg.setAttribute("height", mm(H));
  svg.setAttribute("viewBox", `0 0 ${W} ${H}`);

  const safeLen = Math.min(Math.max(10, bandLen), W - 2);
  
  const bandOffset = unity ? versoOff : {x: rectoOffX, y: rectoOffY};
  
  // LOGIQUE DE CENTRAGE DU CONTENU DANS LA PAGE A4 (MM)
  const baseLeft = (W - safeLen)/2;
  const left = baseLeft + bandOffset.x;
  
  const totalH = 3*bandHeight + 2*gapV;
  const baseTop = (H - totalH)/2;
  const top = baseTop + bandOffset.y; 
  
  const y2 = top;
  const y3 = y2 + bandHeight + gapV;
  const y1 = y3 + bandHeight + gapV;
  const ys = [y1, y3, y2];
  
  const fillColor = (colorMode === 'colored' && denomColors[denom]) ? denomColors[denom] : 'white';
  
  const sepDash = dash.trim() === '0' || dash.trim() === '' ? '0' : dash;


  for(const y0 of ys){
    const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    rect.setAttribute("x", left); rect.setAttribute("y", y0);
    rect.setAttribute("width", safeLen); rect.setAttribute("height", bandHeight);
    rect.setAttribute("fill", fillColor); 
    rect.setAttribute("stroke","black");
    rect.setAttribute("stroke-width", mm(frameW));
    svg.appendChild(rect);

    if(unity){
      const unityText = getUnityText(unitMode, customText);
      
      if(unityText === 'fraction'){
          // Si unité est 1/1, utiliser fracSVG en mode d=1
          const cx = left + safeLen/2;
          const cy = y0 + bandHeight/2;
          svg.appendChild(fracSVG(cx, cy, labelPt, 1, gapTop, gapBottom, barRatio, barW, 'numeric', textOrientation, unitPartDisplay, customText, true));

      } else {
          // Si unité est personnalisée, simple, ou en pourcentage/minutes
          const t = document.createElementNS("http://www.w3.org/2000/svg","text");
          t.setAttribute("x", left + safeLen/2); t.setAttribute("y", y0 + bandHeight/2);
          t.setAttribute("text-anchor","middle"); t.setAttribute("dominant-baseline","middle");
          t.setAttribute("font-size", labelPt+"pt"); 
          t.textContent = unityText;
          svg.appendChild(t);
      }
      
    }else{
      // Bandes divisées (Recto)
      if (innerBorders === 'visible') {
          for(let k=1;k<denom;k++){
            const x = left + safeLen * k / denom;
            const sep = document.createElementNS("http://www.w3.org/2000/svg","line");
            sep.setAttribute("x1", x); sep.setAttribute("x2", x);
            sep.setAttribute("y1", y0); sep.setAttribute("y2", y0 + bandHeight);
            sep.setAttribute("stroke","black"); 
            sep.setAttribute("stroke-width", mm(dotW));
            sep.setAttribute("stroke-dasharray", sepDash); 
            svg.appendChild(sep);
          }
      }
      
      for(let k=0;k<denom;k++){
        const cx = left + safeLen*(k+0.5)/denom;
        const cy = y0 + bandHeight/2;
        // isUnitD1=false ici car ce n'est pas la bande unité
        svg.appendChild(fracSVG(cx, cy, labelPt, denom, gapTop, gapBottom, barRatio, barW, textMode, textOrientation, unitPartDisplay, customText, false));
      }
    }
  }

  page.appendChild(svg);
  return page;
}

function parseDenoms(s){ return s.split(",").map(v=>parseInt(v.trim(),10)).filter(v=>!isNaN(v)); }

function generate(){
  const bandLen = parseFloat(document.getElementById("bandLen").value);
  const bandHeight = parseFloat(document.getElementById("bandHeight").value);
  const gapV = parseFloat(document.getElementById("gapV").value);
  
  const rectoOffX = parseFloat(document.getElementById("rectoOffX").value)||0;
  const rectoOffY = parseFloat(document.getElementById("rectoOffY").value)||0;

  let denoms = parseDenoms(document.getElementById("denoms").value).filter(d => d > 1).sort((a, b) => a - b);
  
  const labelPt = parseFloat(document.getElementById("labelPt").value);
  const dash = document.getElementById("dash").value;
  
  const frameW = parseFloat(document.getElementById("frameW").value);
  const dotW = parseFloat(document.getElementById("dotW").value);
  const gapTop = parseFloat(document.getElementById("gapTop").value);
  const gapBottom = parseFloat(document.getElementById("gapBottom").value);
  const barRatio = parseFloat(document.getElementById("barRatio").value);
  const barW = parseFloat(document.getElementById("barW").value);

  const mode = document.getElementById("mode").value;
  const includeUnit = document.getElementById("includeUnit").value === "yes"; 
  const textMode = document.getElementById("textMode").value; 
  const textOrientation = document.getElementById("textOrientation").value; 
  const colorMode = document.getElementById("colorMode").value; 
  const innerBorders = document.getElementById("innerBorders").value; 
  
  const unitMode = document.getElementById("unitMode").value; 
  const customText = document.getElementById("customText").value || '1 unité';
  const unitPartDisplay = document.getElementById("unitPartDisplay").value; 

  const offX = parseFloat(document.getElementById("offX").value)||0;
  const offY = parseFloat(document.getElementById("offY").value)||0;
  const versoOff = {x: offX, y: offY};

  const preview = document.getElementById("preview");
  preview.innerHTML = "";

  const push = (el)=>preview.appendChild(el);

  const draw = (d, u) => drawPage({bandLen, bandHeight, gapV, labelPt, dash, frameW, dotW, gapTop, gapBottom, barRatio, barW, denom:d, unity:u, rectoOffX, rectoOffY, versoOff, textMode, textOrientation, colorMode, innerBorders, unitMode, customText, unitPartDisplay});


  // Logique de génération par mode
  if(mode==="recto"){
    if(includeUnit){
      const pU = draw(1, true); 
      push(pU);
    }
    for(const d of denoms){
      const p = draw(d, false); 
      push(p);
    }
  }else if(mode==="verso"){
    for(const d of denoms){
      const p = draw(d, true); 
      push(p);
    }
    if (includeUnit){
        const pU = draw(1, true);
        push(pU);
    }
  }else if(mode==="interleaved"){
    if(includeUnit){
      const pU = draw(1, true); 
      push(pU);
    }
    for(const d of denoms){
      const pV = draw(d, true);  
      push(pV);
      const pR = draw(d, false); 
      push(pR);
    }
  } else if (mode === "recto-verso") {
    // Nouveau mode: Fraction x2
    if(includeUnit){
      const pU = draw(1, true); // L'unité est toujours générée seule (avec texte unité)
      push(pU);
    }
    for(const d of denoms){
        // Page 1 (Recto)
        const pR1 = draw(d, false); 
        push(pR1);
        // Page 2 (Verso - Même contenu pour recto-verso)
        const pR2 = draw(d, false); 
        push(pR2);
    }
  }
}

document.getElementById("print").addEventListener("click", ()=>{ window.print(); });

// Gérer l'affichage du champ de texte personnalisé et de l'unité fractionnée
function updateUI() {
    const unitMode = document.getElementById('unitMode').value;
    const textMode = document.getElementById('textMode').value;
    const includeUnit = document.getElementById('includeUnit').value;
    const unitPartDisplayContainer = document.getElementById('unitPartDisplayContainer');
    
    // 1. Affichage du champ de texte personnalisé
    document.getElementById('customText').style.display = unitMode === 'custom' ? 'block' : 'none';
    
    // 2. Affichage conditionnel de l'option "Unité fractionnée" (seulement pour numeric et decimal)
    const isFractionCompatible = (textMode === 'numeric' || textMode === 'decimal');
    const isUnitIncluded = includeUnit === 'yes';

    if (isUnitIncluded && isFractionCompatible) {
        unitPartDisplayContainer.style.display = 'block';
    } else {
        unitPartDisplayContainer.style.display = 'none';
    }
    
    // Initialisation du texte personnalisé (Réglage de base)
    const customTextInput = document.getElementById('customText');
    if (!customTextInput.value.trim()) { 
        customTextInput.value = '1 unité'; 
    }
        
    generate();
}

// Écouteurs pour la régénération automatique
document.getElementById('form').addEventListener('change', updateUI);
document.getElementById('form').addEventListener('input', (e) => {
    const targetId = e.target.id;
    // On ne régénère qu'après l'input sur les champs numériques/texte
    if (['bandLen', 'bandHeight', 'gapV', 'denoms', 'customText', 'dash', 'rectoOffX', 'rectoOffY', 'offX', 'offY', 'labelPt', 'gapTop', 'gapBottom', 'barRatio', 'barW'].includes(targetId)) {
        generate();
    }
});


// Générer au chargement
window.addEventListener("load", updateUI);
</script>
</body>
</html>
