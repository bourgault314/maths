\documentclass[a4paper,12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage[left=0.5cm, right=0.5cm, top=0.5cm, bottom=0.5cm]{geometry}
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing, arrows.meta, patterns, calc}
\usepackage{tcolorbox}
\usepackage{amssymb}

% Couleurs (identiques à tes gabarits)
\definecolor{mypink}{RGB}{235, 150, 150}
\definecolor{myorange}{RGB}{240, 180, 120}

\pagestyle{empty}

% ==================================================
% GABARIT MULTIPLICATIF (2 inconnues) : Grande = k × Petite
% (Mise en page calée sur ton x2 validé)
% ==================================================
\newcommand{\GabaritMultDeux}[1]{%
\def\k{#1}%
\pgfmathtruncatemacro{\u}{\k+1}%
\def\W{9.0}%
\pgfmathsetmacro{\unit}{\W/\u}%
\pgfmathsetmacro{\Wbig}{\k*\unit}%

\begin{tcolorbox}[colback=white, colframe=black, title=\centering\textbf{GABARIT : ENQUÊTE MULTIPLICATIVE À DEUX INCONNUES (cas \texttimes\ \k)}]
    \centering
    \begin{tikzpicture}[scale=0.80, every node/.style={font=\bfseries\small}]

        % Même référence de mise en page que tes gabarits (0..9)
        \path[use as bounding box] (0, 7.2) rectangle (\W, -20.4);
        \def\Xstep{-3.5}

        % =========================
        % ÉTAPE 1 : REPRÉSENTER
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, 7.0) {\large ÉTAPE 1 : REPRÉSENTER (Je dessine)};
        \node[overlay, anchor=east] at (-0.2, 5.5) {Petite part : ....................};
        \node[overlay, anchor=east] at (-0.2, 4.0) {Grande part : ....................};

        % Petite (1 unité)
        \draw[thick, fill=mypink!30] (0, 5.0) rectangle (\unit, 6.0);
        \node at ({0.5*\unit}, 5.5) {\Large ?};

        % Grande (k unités identiques)
        \draw[thick, fill=mypink!30] (0, 3.5) rectangle (\Wbig, 4.5);
        \foreach \i in {1,...,\numexpr\k-1\relax} {
            \draw[dashed, gray!60, thick] ({\i*\unit}, 3.5) -- ({\i*\unit}, 4.5);
        }
        \foreach \i in {0,...,\numexpr\k-1\relax} {
            \node at ({(\i+0.5)*\unit}, 4.0) {\Large ?};
        }

        % Accolade TOTAL (droite) — identique à la version validée
        \draw [decorate, decoration={brace, amplitude=12pt, mirror}, thick]
            ({\Wbig+0.2}, 3.2) -- ({\Wbig+0.2}, 6.2) node [midway, right=15pt] {\textbf{TOTAL = ..........}};

        % =========================
        % ÉTAPE 2 : VISUALISER
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, 1.7) {\large ÉTAPE 2 : VISUALISER (J'aligne tout)};

        \begin{scope}[yshift=1.0cm]
            % Total (orange) au-dessus
            \draw[thick, fill=myorange!50] (0, -1.1) rectangle (\W, -0.1);
            \node at ({0.5*\W}, -0.6) {\large ....................};

            % Total en (k+1) unités égales (rose) en dessous
            \foreach \i in {0,...,\numexpr\u-1\relax} {
                \draw[thick, fill=mypink!30] ({\i*\unit}, -2.1) rectangle ({(\i+1)*\unit}, -1.1);
                \node at ({(\i+0.5)*\unit}, -1.6) {\Large ?};
            }

            % Accolades en dessous : petite / grande
            \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
                (0, -2.3) -- (\unit, -2.3) node [midway, below=6pt] {Petite part};
            \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
                (\unit, -2.3) -- (\W, -2.3) node [midway, below=6pt] {Grande part};
        \end{scope}

        % =========================
        % ÉTAPE 3 : CALCULER (DIVISER)
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, -3.5) {\large ÉTAPE 3 : CALCULER (Je divise le total en \u)};

        % Ligne du total (orange) : des points dans chaque case
        \foreach \i in {0,...,\numexpr\u-1\relax} {
            \draw[thick, fill=myorange!50] ({\i*\unit}, -5.5) rectangle ({(\i+1)*\unit}, -4.5);
            \node at ({(\i+0.5)*\unit}, -5.0) {\large .....};
        }

        % Ligne des (k+1) parts égales (rose)
        \foreach \i in {0,...,\numexpr\u-1\relax} {
            \draw[thick, fill=mypink!30] ({\i*\unit}, -6.5) rectangle ({(\i+1)*\unit}, -5.5);
            \node at ({(\i+0.5)*\unit}, -6.0) {\Large ?};
        }

        % Séparations (bleues) pour matérialiser la division
        \foreach \i in {1,...,\numexpr\u-1\relax} {
            \draw[dashed, ultra thick, blue] ({\i*\unit}, -4.3) -- ({\i*\unit}, -6.7);
        }

        % =========================
        % ÉTAPE 4 : CALCULER (TROUVER LES DEUX PARTS)
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, -7.8) {\large ÉTAPE 4 : CALCULER (Je trouve les deux parts)};

        % Petite = 1 unité (orange)
        \draw[thick, fill=myorange!50] (0, -9.8) rectangle (\unit, -8.8);
        \node at ({0.5*\unit}, -9.3) {\large .....};

        % Grande = k unités (orange) — "bloc combiné"
        \draw[thick, fill=myorange!50] (\unit, -9.8) rectangle (\W, -8.8);
        \node at ({\unit + 0.5*(\W-\unit)}, -9.3) {\large ..........};

        % Rappel visuel (rose) : (k+1) unités
        \foreach \i in {0,...,\numexpr\u-1\relax} {
            \draw[thick, fill=mypink!30] ({\i*\unit}, -10.8) rectangle ({(\i+1)*\unit}, -9.8);
            \node at ({(\i+0.5)*\unit}, -10.3) {\Large ?};
        }

        % Accolades (rappel : petite / grande)
        \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
            (0, -11.05) -- (\unit, -11.05) node [midway, below=6pt] {Petite part};
        \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
            (\unit, -11.05) -- (\W, -11.05) node [midway, below=6pt] {Grande part};

        % Cadre réponses
        \node[fill=yellow!20, thick, draw, inner sep=10pt, align=left] at ({0.5*\W}, -14.8) {
            \large \textbf{RÉPONSES :} \\[0.3cm]
            \large Petite part : ..................... \quad \quad Grande part : .....................
        };

        % Cadre vérification (rapproché)
        \node[draw=green!50!black, dashed, thick, rounded corners, inner sep=10pt, align=left] at ({0.5*\W}, -18.0) {
            \large \textbf{JE VÉRIFIE (OBLIGATOIRE) :} \\[0.3cm]
            \normalsize 1. Somme : ........ + ........ = \textbf{.......... (Total ?)} \quad $\square$ OK \\[0.3cm]
            \normalsize 2. Rapport : ........ $\div$ ........ = \textbf{\k\ (Facteur ?)} \quad $\square$ OK
        };

    \end{tikzpicture}
\end{tcolorbox}
} % fin macro


% ==================================================
%  CAS GENERAL : Grande = n × Petite (n à compléter)
%  Représentation schématique avec "..." (unités répétées)
% ==================================================
\newcommand{\GabaritMultDeuxN}{%
\def\W{9.0}%
\def\U{1.6}% largeur d'une "unité visible" (schéma)
\def\H{1.0}%
\def\Wbig{7.4}% largeur de la grande part au schéma (étape 1)

\begin{tcolorbox}[colback=white, colframe=black, title=\centering\textbf{GABARIT : ENQUÊTE MULTIPLICATIVE À DEUX INCONNUES (cas \texttimes\ n)}]
    \centering
    \begin{tikzpicture}[scale=0.80, every node/.style={font=\bfseries\small}]

        \path[use as bounding box] (0, 7.2) rectangle (\W, -20.4);
        \def\Xstep{-3.5}

        % =========================
        % ÉTAPE 1 : REPRÉSENTER
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, 7.0) {\large ÉTAPE 1 : REPRÉSENTER (Je dessine)};
        \node[overlay, anchor=east] at (-0.2, 5.5) {Petite part : ....................};
        \node[overlay, anchor=east] at (-0.2, 4.0) {Grande part : ....................};

        % Petite (1 unité)
        \draw[thick, fill=mypink!30] (0, 5.0) rectangle (\U, 6.0);
        \node at ({0.5*\U}, 5.5) {\Large ?};

        % Grande (n unités identiques) — schéma : 2 premières + "..." + dernière
        \draw[thick, fill=mypink!30] (0, 3.5) rectangle (\Wbig, 4.5);
        \draw[dashed, gray!60, thick] (\U, 3.5) -- (\U, 4.5);
        \draw[dashed, gray!60, thick] ({2*\U}, 3.5) -- ({2*\U}, 4.5);
        \draw[dashed, gray!60, thick] ({\Wbig-\U}, 3.5) -- ({\Wbig-\U}, 4.5);

        \node at ({0.5*\U}, 4.0) {\Large ?};
        \node at ({1.5*\U}, 4.0) {\Large ?};
        \node at ({0.5*(2*\U+\Wbig-\U)}, 4.0) {\Large $\cdots$};
        \node at ({\Wbig-0.5*\U}, 4.0) {\Large ?};

        % Indication du facteur (à compléter)
        
        
        % Accolade (facteur) sous la grande part : ? × ____ (n à compléter)
        \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
            (0, 3.35) -- (\Wbig, 3.35) node [midway, below=6pt] {\Large ? $\times$ ..............};

% Accolade TOTAL (droite)
        \draw [decorate, decoration={brace, amplitude=12pt, mirror}, thick]
            ({\Wbig+0.2}, 3.2) -- ({\Wbig+0.2}, 6.2) node [midway, right=15pt] {\textbf{TOTAL = ..........}};

        % =========================
        % ÉTAPE 2 : VISUALISER
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, 1.3) {\large ÉTAPE 2 : VISUALISER (J'aligne tout)};

        \begin{scope}[yshift=0.6cm]
            % Total (orange) au-dessus
            \draw[thick, fill=myorange!50] (0, -1.1) rectangle (\W, -0.1);
            \node at ({0.5*\W}, -0.6) {\large ....................};

            % Alignement (rose) : Petite + Grande (schéma avec "...")
            \draw[thick, fill=mypink!30] (0, -2.1) rectangle (\W, -1.1);

            % séparations : petite / grande et unités visibles dans la grande
            \draw[dashed, gray!60, thick] (\U, -2.1) -- (\U, -1.1);
            \draw[dashed, gray!60, thick] ({2*\U}, -2.1) -- ({2*\U}, -1.1);
            \draw[dashed, gray!60, thick] ({3*\U}, -2.1) -- ({3*\U}, -1.1);
            \draw[dashed, gray!60, thick] ({\W-\U}, -2.1) -- ({\W-\U}, -1.1);

            % contenus
            \node at ({0.5*\U}, -1.6) {\Large ?};
            \node at ({1.5*\U}, -1.6) {\Large ?};
            \node at ({2.5*\U}, -1.6) {\Large ?};
            \node at ({0.5*(3*\U+\W-\U)}, -1.6) {\Large $\cdots$};
            \node at ({\W-0.5*\U}, -1.6) {\Large ?};

            % Accolades en dessous : petite / grande
            \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
                (0, -2.3) -- (\U, -2.3) node [midway, below=6pt] {Petite part};
            \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
                (\U, -2.3) -- (\W, -2.3) node [midway, below=6pt] {Grande part};
        \end{scope}

        % =========================
        % ÉTAPE 3 : CALCULER (DIVISER)
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, -3.5) {\large ÉTAPE 3 : CALCULER (Je divise le total en ....)};

        % Ligne du total (orange) : schéma avec "..."
        \draw[thick, fill=myorange!50] (0, -5.5) rectangle (\W, -4.5);

        \node at ({0.5*\U}, -5.0) {\large .....};
        \node at ({1.5*\U}, -5.0) {\large .....};
        \node at ({2.5*\U}, -5.0) {\large .....};
        \node at ({0.5*(3*\U+\W-\U)}, -5.0) {\Large $\cdots$};
        \node at ({\W-0.5*\U}, -5.0) {\large .....};

        % Ligne des parts égales (rose)
        \draw[thick, fill=mypink!30] (0, -6.5) rectangle (\W, -5.5);
        \draw[dashed, gray!60, thick] (\U, -6.5) -- (\U, -5.5);
        \draw[dashed, gray!60, thick] ({2*\U}, -6.5) -- ({2*\U}, -5.5);
        \draw[dashed, gray!60, thick] ({3*\U}, -6.5) -- ({3*\U}, -5.5);
        \draw[dashed, gray!60, thick] ({\W-\U}, -6.5) -- ({\W-\U}, -5.5);

        % Séparations (bleues) pour matérialiser la division (comme les autres pages)
        \draw[dashed, ultra thick, blue] (\U, -4.3) -- (\U, -6.7);
        \draw[dashed, ultra thick, blue] ({2*\U}, -4.3) -- ({2*\U}, -6.7);
        \draw[dashed, ultra thick, blue] ({3*\U}, -4.3) -- ({3*\U}, -6.7);
        \draw[dashed, ultra thick, blue] ({\W-\U}, -4.3) -- ({\W-\U}, -6.7);


        \node at ({0.5*\U}, -6.0) {\Large ?};
        \node at ({1.5*\U}, -6.0) {\Large ?};
        \node at ({2.5*\U}, -6.0) {\Large ?};
        \node at ({0.5*(3*\U+\W-\U)}, -6.0) {\Large $\cdots$};
        \node at ({\W-0.5*\U}, -6.0) {\Large ?};

        % =========================
        % ÉTAPE 4 : CALCULER (TROUVER LES DEUX PARTS)
        % =========================
        \node[overlay, anchor=west, blue!80!black] at (\Xstep, -7.8) {\large ÉTAPE 4 : CALCULER (Je trouve les deux parts)};

        % Petite (orange)
        \draw[thick, fill=myorange!50] (0, -9.8) rectangle (\U, -8.8);
        \node at ({0.5*\U}, -9.3) {\large .....};

        % Grande (orange) — bloc combiné avec "..."
        \draw[thick, fill=myorange!50] (\U, -9.8) rectangle (\W, -8.8);
        \node at ({\U + 0.5*(\W-\U)}, -9.3) {\large ..........};

        % Rappel visuel (rose) : schéma Petite + Grande
        \draw[thick, fill=mypink!30] (0, -10.8) rectangle (\W, -9.8);
        \draw[dashed, gray!60, thick] (\U, -10.8) -- (\U, -9.8);
        \draw[dashed, gray!60, thick] ({2*\U}, -10.8) -- ({2*\U}, -9.8);
        \draw[dashed, gray!60, thick] ({3*\U}, -10.8) -- ({3*\U}, -9.8);
        \draw[dashed, gray!60, thick] ({\W-\U}, -10.8) -- ({\W-\U}, -9.8);

        \node at ({0.5*\U}, -10.3) {\Large ?};
        \node at ({1.5*\U}, -10.3) {\Large ?};
        \node at ({2.5*\U}, -10.3) {\Large ?};
        \node at ({0.5*(3*\U+\W-\U)}, -10.3) {\Large $\cdots$};
        \node at ({\W-0.5*\U}, -10.3) {\Large ?};

        % Accolades : petite / grande
        \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
            (0, -11.05) -- (\U, -11.05) node [midway, below=6pt] {Petite part};
        \draw [decorate, decoration={brace, amplitude=5pt, mirror}, thick]
            (\U, -11.05) -- (\W, -11.05) node [midway, below=6pt] {Grande part};

        % Cadre réponses
        \node[fill=yellow!20, thick, draw, inner sep=10pt, align=left] at ({0.5*\W}, -14.8) {
            \large \textbf{RÉPONSES :} \\[0.3cm]
            \large Petite part : ..................... \quad \quad Grande part : .....................
        };

        % Cadre vérification
        \node[draw=green!50!black, dashed, thick, rounded corners, inner sep=10pt, align=left] at ({0.5*\W}, -18.0) {
            \large \textbf{JE VÉRIFIE (OBLIGATOIRE) :} \\[0.3cm]
            \large 1. Somme : ........ + ........ = \textbf{.......... (Total ?)} \quad $\square$ OK \\[0.2cm]
            \large 2. Rapport : ........ $\div$ ........ = \textbf{.......... (Facteur ?)} \quad $\square$ OK
        };

    \end{tikzpicture}
\end{tcolorbox}} % fin macro (cas général)

\begin{document}

\GabaritMultDeux{2}
\newpage
\GabaritMultDeux{3}
\newpage
\GabaritMultDeux{4}
\newpage
\GabaritMultDeux{5}
\newpage
\GabaritMultDeux{6}
\newpage
\GabaritMultDeuxN

\end{document}
