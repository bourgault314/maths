<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Boulier Montessori – Exerciseur</title>
<style>
  :root{
    --rows: 4;
    --beads-per-row: 10;
    --bead-size: 26px;
    --bead-gap: 6px;
    --frame-thickness: 14px;
    --rod-thickness: 4px;

    --color-1: #3cb371;
    --color-10: #40c4ff;
    --color-100: #e53935;
    --color-1000: #2e7d32;

    --color-wood: #e2c48a;
    --color-wood-dark: #a88348;

    --bg: #fffdf8;
    --text: #1b1b1b;
    --ui: #f3f1ea;
    --accent: #0f6cf9;
    --ok: #0f9d58;
    --err: #d93025;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:760px;margin:14px auto;padding:0 12px}

  .topbar{
    display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;margin:6px 0 12px
  }
  .btn{
    border:none;background:var(--accent);color:#fff;font-weight:700;
    padding:8px 12px;border-radius:10px;cursor:pointer;
    box-shadow:0 5px 12px rgba(15,108,249,.18);font-size:.95rem
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#6b7280}

  .score{margin-left:auto;display:flex;gap:12px;align-items:center;font-weight:800}
  .score .good{color:var(--ok)}
  .score .bad{color:var(--err)}

  .exercise{
    display:flex;flex-wrap:wrap;gap:8px;align-items:center;
    background:var(--ui);padding:10px 12px;border-radius:12px;margin-bottom:10px
  }
  .exercise .target{
    font-weight:800;font-size:1.2rem;background:#fff;padding:6px 10px;border-radius:10px;min-width:4ch;text-align:center;
    box-shadow:inset 0 1px 0 rgba(0,0,0,.05);
  }
  .feedback{min-height:1.4em;font-weight:700}
  .feedback.ok{color:var(--ok)}
  .feedback.err{color:var(--err)}

  .abacus-wrapper{display:flex;align-items:stretch}
  .labels{
    display:flex;flex-direction:column;justify-content:space-around;
    padding:10px 6px 10px 0;font-weight:700;font-size:1rem;color:#444;
    background:#f0f0f0;border-radius:10px 0 0 10px;
    box-shadow:inset -1px 0 2px rgba(0,0,0,.1)
  }
  .labels div{flex:1;display:flex;align-items:center;justify-content:center}

  .abacus{
    flex:1;position:relative;aspect-ratio: 10 / 4.5;
    background:linear-gradient(180deg,var(--color-wood) 0%, #efd79d 55%, var(--color-wood) 100%);
    border-radius:0 14px 14px 0;box-shadow:0 8px 20px rgba(0,0,0,.1);
    padding: calc(var(--frame-thickness) + 6px) calc(var(--frame-thickness) + 8px);
  }
  .abacus::before, .abacus::after{
    content:"";position:absolute;left:0;right:0;height:var(--frame-thickness);
    background:linear-gradient(#caa367,#9a733c)
  }
  .abacus::before{top:0;border-bottom:2px solid var(--color-wood-dark);border-radius:0 14px 0 0}
  .abacus::after{bottom:0;border-top:2px solid var(--color-wood-dark);border-radius:0 0 14px 0}

  .row{position:relative;height:calc(100%/var(--rows))}
  .rod{
    position:absolute;left:0;right:0;top:50%;height:var(--rod-thickness);transform:translateY(-50%);
    background:linear-gradient(180deg,#c19a66,#916c3d);border-radius:3px;box-shadow:inset 0 1px 0 rgba(255,255,255,.45),0 1px 2px rgba(0,0,0,.25)
  }
  .bead{
    position:absolute;top:50%;transform:translate(-50%,-50%);
    width:var(--bead-size);height:var(--bead-size);border-radius:50%;
    box-shadow:0 3px 6px rgba(0,0,0,.25),inset 0 2px 5px rgba(255,255,255,.5);
    border:1px solid rgba(0,0,0,.1);cursor:pointer;user-select:none;
    transition:left .18s ease,transform .06s ease
  }
  .bead:active{transform:translate(-50%,-50%) scale(.95)}

  /* Overlay géant */
  .overlay{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    font-size:8rem;font-weight:900;color:white;text-shadow:0 0 30px rgba(0,0,0,.7);
    pointer-events:none;opacity:0;transition:opacity .2s ease;
  }
  .overlay.show{opacity:1}
  .overlay.ok{color:var(--ok)}
  .overlay.err{color:var(--err)}
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div style="display:flex;gap:8px;align-items:center;">
        <button class="btn" id="newNumber">Nouveau nombre</button>
        <button class="btn" id="check">Vérifier</button>
        <button class="btn secondary" id="reset">Remise à zéro</button>
      </div>
      <div class="score">
        <span class="good">✅ : <span id="goodCount">0</span></span>
        <span class="bad">❌ : <span id="badCount">0</span></span>
      </div>
    </div>

    <div class="exercise">
      <div>Place ce nombre sur le boulier :</div>
      <div class="target" id="target">—</div>
      <div class="feedback" id="feedback"></div>
    </div>

    <div class="abacus-wrapper">
      <div class="labels">
        <div>1</div><div>10</div><div>100</div><div>1000</div>
      </div>
      <div class="abacus" id="abacus"></div>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

<script>
(function(){
  const rows=4, N=10, values=[1,10,100,1000];
  const abacus=document.getElementById('abacus');
  const newBtn=document.getElementById('newNumber');
  const checkBtn=document.getElementById('check');
  const resetBtn=document.getElementById('reset');
  const targetEl=document.getElementById('target');
  const feedback=document.getElementById('feedback');
  const goodEl=document.getElementById('goodCount');
  const badEl=document.getElementById('badCount');
  const overlay=document.getElementById('overlay');

  const colors=['var(--color-1)','var(--color-10)','var(--color-100)','var(--color-1000)'];
  const state=Array.from({length:rows},()=>0);
  let target=null,goodCount=0,badCount=0,scored=false,advancing=false;

  const rowEls=[];
  for(let r=0;r<rows;r++){
    const row=el('div','row');row.dataset.row=r;
    row.appendChild(el('div','rod'));
    for(let j=1;j<=N;j++){
      const bead=el('div','bead');bead.style.background=colors[r];
      bead.dataset.index=j;
      bead.addEventListener('click',()=>onBeadClick(r,j));
      row.appendChild(bead);
    }
    abacus.appendChild(row);rowEls.push(row);
  }

  function onBeadClick(r,j){
    if(advancing) return;
    const c=state[r], left=N-c;
    state[r]=(j<=left)?(N-j+1):(N-j);
    state[r]=Math.max(0,Math.min(N,state[r]));
    layoutRow(r);
  }
  function layoutRow(r){
    const row=rowEls[r],c=state[r];
    const size=26,gap=6,pad=10;
    const leftStart=pad+size/2, rightStart=row.clientWidth-pad-size/2;
    [...row.querySelectorAll('.bead')].forEach(b=>{
      const j=+b.dataset.index;
      b.style.left=(j<=N-c)?leftStart+(j-1)*(size+gap)+"px":rightStart-(N-j)*(size+gap)+"px";
    });
  }
  function layoutAll(){for(let r=0;r<rows;r++)layoutRow(r);}
  function currentTotal(){return state.reduce((s,c,r)=>s+c*values[r],0);}
  function resetAbacus(){state.fill(0);layoutAll();}

  function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
  function newTarget(){
    target=randomInt(0,9999);targetEl.textContent=String(target);
    resetAbacus();feedback.textContent='';scored=false;advancing=false;
  }

  function showOverlay(ok){
    overlay.textContent=ok?"✅":"❌";
    overlay.className="overlay show "+(ok?"ok":"err");
    setTimeout(()=>overlay.className="overlay",1000);
  }

  newBtn.addEventListener('click',newTarget);
  resetBtn.addEventListener('click',()=>{resetAbacus();feedback.textContent='';});

  checkBtn.addEventListener('click',()=>{
    if(advancing)return;
    if(target===null){feedback.textContent="Clique sur “Nouveau nombre”.";feedback.className="feedback err";return;}
    const val=currentTotal();
    if(val===target){
      if(!scored){goodCount++;goodEl.textContent=goodCount;scored=true;}
      feedback.textContent="OK ✅";feedback.className="feedback ok";showOverlay(true);
      advancing=true;setTimeout(newTarget,1000);
    }else{
      badCount++;badEl.textContent=badCount;
      feedback.textContent="❌ Mauvaise réponse";feedback.className="feedback err";showOverlay(false);
    }
  });

  window.addEventListener('resize',()=>layoutAll());
  function el(tag,cls){const e=document.createElement(tag);if(cls)e.className=cls;return e;}

  layoutAll();newTarget();
})();
</script>
</body>
</html>
