<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Boulier Montessori (unités, dizaines, centaines, milliers)</title>
<style>
  :root{
    --rows: 4;
    --beads-per-row: 10;
    --bead-size: 26px;
    --bead-gap: 6px;
    --frame-thickness: 14px;
    --rod-thickness: 4px;

    --color-1: #3cb371;     /* vert unités */
    --color-10: #40c4ff;    /* bleu dizaines */
    --color-100: #e53935;   /* rouge centaines */
    --color-1000: #2e7d32;  /* vert foncé milliers */

    --color-wood: #e2c48a;
    --color-wood-dark: #a88348;

    --bg: #fffdf8;
    --text: #1b1b1b;
    --ui: #f3f1ea;
    --accent: #0f6cf9;
  }

  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .app{max-width:760px;margin:14px auto;padding:0 12px}

  .toolbar{
    display:flex;gap:10px;align-items:center;justify-content:space-between;margin:8px 0 12px
  }
  .value-box{
    display:none;gap:8px;align-items:center;background:var(--ui);
    padding:6px 10px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.05) inset;
  }
  .value-box.show{display:flex}
  .value-box label{font-weight:600;font-size:.95rem}
  .value-box input{
    width:140px;font-size:1.3rem;font-weight:800;text-align:right;border:none;background:transparent;outline:none
  }
  .btn{
    border:none;background:var(--accent);color:#fff;font-weight:700;
    padding:8px 12px;border-radius:10px;cursor:pointer;
    box-shadow:0 6px 14px rgba(15,108,249,.2);font-size:.95rem
  }
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#6b7280}

  .abacus-wrapper{
    display:flex;align-items:stretch;
  }
  .labels{
    display:flex;flex-direction:column;justify-content:space-around;
    padding:10px 6px 10px 0;font-weight:700;font-size:1rem;color:#444;
    background:#f0f0f0;border-radius:10px 0 0 10px;
    box-shadow:inset -1px 0 2px rgba(0,0,0,.1);
  }
  .labels div{flex:1;display:flex;align-items:center;justify-content:center}

  .abacus{
    flex:1;position:relative;aspect-ratio: 10 / 4.5;
    background:linear-gradient(180deg,var(--color-wood) 0%, #efd79d 55%, var(--color-wood) 100%);
    border-radius:0 14px 14px 0;box-shadow:0 8px 20px rgba(0,0,0,.1);
    padding: calc(var(--frame-thickness) + 6px) calc(var(--frame-thickness) + 8px);
  }
  .abacus::before, .abacus::after{
    content:"";position:absolute;left:0;right:0;height:var(--frame-thickness);
    background:linear-gradient(#caa367,#9a733c)
  }
  .abacus::before{top:0;border-bottom:2px solid var(--color-wood-dark);border-radius:0 14px 0 0}
  .abacus::after{bottom:0;border-top:2px solid var(--color-wood-dark);border-radius:0 0 14px 0}

  .row{position:relative;height: calc(100% / var(--rows));}
  .rod{
    position:absolute;left:0;right:0;top:50%;height:var(--rod-thickness);transform:translateY(-50%);
    background:linear-gradient(180deg,#c19a66,#916c3d);border-radius:3px;box-shadow:inset 0 1px 0 rgba(255,255,255,.45), 0 1px 2px rgba(0,0,0,.25);
  }
  .bead{
    position:absolute;top:50%;transform:translate(-50%,-50%);
    width:var(--bead-size);height:var(--bead-size);border-radius:50%;
    box-shadow: 0 3px 6px rgba(0,0,0,.25), inset 0 2px 5px rgba(255,255,255,.5);
    border:1px solid rgba(0,0,0,.1);cursor:pointer; user-select:none;
    transition:left .18s ease, transform .06s ease;
  }
  .bead:active{transform:translate(-50%,-50%) scale(.95)}
</style>
</head>
<body>
  <div class="app">
    <div class="toolbar">
      <div class="value-box" id="valueBox">
        <label for="total">Valeur :</label>
        <input id="total" type="text" value="0" readonly aria-live="polite" />
      </div>
      <div style="display:flex; gap:8px;">
        <button class="btn" id="toggleValue">Afficher la valeur</button>
        <button class="btn secondary" id="reset">Remise à zéro</button>
      </div>
    </div>

    <div class="abacus-wrapper">
      <div class="labels">
        <div>1</div>
        <div>10</div>
        <div>100</div>
        <div>1000</div>
      </div>
      <div class="abacus" id="abacus" aria-label="Boulier Montessori"></div>
    </div>
  </div>

<script>
(function(){
  const rows = 4, N = 10;
  const values = [1,10,100,1000]; // poids par rangée

  const abacus   = document.getElementById('abacus');
  const totalBox = document.getElementById('total');
  const valueBox = document.getElementById('valueBox');
  const toggleBtn= document.getElementById('toggleValue');
  const resetBtn = document.getElementById('reset');

  const colors = ['var(--color-1)','var(--color-10)','var(--color-100)','var(--color-1000)'];

  const state = Array.from({length: rows}, () => 0); // nb de perles à droite
  let revealed = false;

  const rowEls = [];
  for(let r=0;r<rows;r++){
    const row = el('div','row'); row.dataset.row=r;
    row.appendChild(el('div','rod'));
    for(let j=1;j<=N;j++){
      const bead = el('div','bead');
      bead.style.background = colors[r];
      bead.dataset.index = j;
      bead.addEventListener('click', () => onBeadClick(r, j));
      row.appendChild(bead);
    }
    abacus.appendChild(row);
    rowEls.push(row);
  }

  function onBeadClick(r, j){
    const c = state[r];
    const leftCount = N - c;
    state[r] = (j <= leftCount) ? (N - j + 1) : (N - j);
    state[r] = Math.max(0, Math.min(N, state[r]));
    layoutRow(r);
    renderTotal();
  }

  function layoutRow(r){
    const row = rowEls[r], c = state[r];
    const size = 26, gap = 6, pad = 10;
    const leftStart  = pad + size/2;
    const rightStart = row.clientWidth - pad - size/2;
    [...row.querySelectorAll('.bead')].forEach(b=>{
      const j = +b.dataset.index;
      b.style.left = (j <= N - c)
        ? leftStart  + (j-1)*(size+gap)+"px"
        : rightStart - (N-j)*(size+gap)+"px";
    });
  }

  function layoutAll(){ for(let r=0;r<rows;r++) layoutRow(r); renderTotal(); }
  function currentTotal(){ return state.reduce((sum,c,r)=> sum + c*values[r],0); }

  function renderTotal(){
    if(revealed){
      valueBox.classList.add('show');
      totalBox.value = String(currentTotal());
    }else{
      valueBox.classList.remove('show');
    }
  }

  toggleBtn.addEventListener('click', ()=>{
    revealed = !revealed;
    toggleBtn.textContent = revealed ? 'Masquer la valeur' : 'Afficher la valeur';
    renderTotal();
  });

  resetBtn.addEventListener('click', ()=>{ state.fill(0); layoutAll(); });

  let t; window.addEventListener('resize', ()=>{ clearTimeout(t); t=setTimeout(layoutAll,60); });

  function el(tag,cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }

  layoutAll();
})();
</script>
</body>
</html>
