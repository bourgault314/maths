<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>REKENREK ‚Äî JEU DU RIDEAU (FINAL)</title>
  <style>
    :root {
      --ink: #111827; --bg: #f8fafc; --panel: #ffffff; --accent: #2563eb; --border: #cbd5e1; --grid-line: #94a3b8; 
      --page-w: 210mm; --page-h: 297mm; --page-margin: 10mm; --cols: 3; --rows: 5;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--ink); display: flex; height: 100vh; overflow: hidden; }
    aside { width: 340px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
    .sb-header { padding: 15px 20px; border-bottom: 1px solid var(--border); background: #fff; }
    .sb-title { font-size: 18px; font-weight: 800; color: var(--accent); margin: 0; text-transform: uppercase; }
    .sb-scroll { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
    .section { border-bottom: 1px solid #f1f5f9; padding-bottom: 15px; }
    .sec-title { font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 800; margin-bottom: 10px; }
    .corr-toggle { display: flex; align-items: center; gap: 10px; background: #eff6ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe; cursor: pointer; }
    .corr-toggle input { width: 20px; height: 20px; cursor: pointer; }
    .corr-text { font-weight: 800; color: var(--accent); font-size: 14px; }
    .control { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; font-size: 13px; font-weight: 600; }
    select, input[type="number"] { padding: 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; font-weight: 600; width: 100%; outline: none; background: #fff; }
    .flags { display: flex; gap: 10px; margin-bottom: 10px; }
    .flag-btn { font-size: 12px; font-weight: 800; cursor: pointer; opacity: 0.5; padding: 4px 10px; border-radius: 6px; background:#f1f5f9; border: 1px solid #e2e8f0; }
    .flag-btn.active { opacity: 1; background: var(--accent); color: white; border-color: var(--accent); }
    .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto; }
    .btn { padding: 12px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; color: white; font-size: 13px; }
    .btn-new { background: var(--accent); }
    .btn-print { background: #10b981; }
    main { flex: 1; overflow: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; background: #e2e8f0; }
    .page { width: var(--page-w); height: var(--page-h); background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.15); position: relative; flex-shrink: 0; page-break-after: always; }
    .page-inner { position: absolute; top: var(--page-margin); bottom: var(--page-margin); left: var(--page-margin); right: var(--page-margin); display: flex; flex-direction: column; }
    .grid { flex: 1; display: grid; grid-template-columns: repeat(var(--cols), 1fr); grid-template-rows: repeat(var(--rows), 1fr); border: 2px solid var(--ink); min-height: 0; }
    .cell { border: 1px solid var(--grid-line); display: flex; flex-direction: column; padding: 3px; position: relative; overflow: hidden; }
    .part-boulier { flex: 1; display: flex; align-items: center; justify-content: center; border-bottom: 1px dashed #cbd5e1; margin-bottom: 2px; overflow: hidden; padding: 2px; min-height: 0; }
    .rr-svg { width: 100%; height: 100%; display: block; overflow: visible; }
    .part-bottom { flex: 0 0 60px; display: flex; gap: 4px; }
    .box-ans { flex: 0 0 80px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; border-radius: 6px; background: #fdfdfd; position: relative; }
    .box-info { flex: 1; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; border-radius: 6px; background: #fdfdfd; position: relative; }
    .val-digit { font-size: 28px; font-weight: 900; color: #000; }
    .val-equation { font-size: 18px; font-weight: 700; color: #475569; font-family: 'Courier New', monospace; letter-spacing: -0.5px; white-space: nowrap; }
    @media print { @page { size: A4; margin: 0; } body { display: block; background: white; height: auto; overflow: visible; } aside { display: none !important; } main { padding: 0; margin: 0; display: block; overflow: visible; height: auto; } .page { margin: 0 auto; box-shadow: none; border: none; width: 210mm; height: 297mm; overflow: hidden; page-break-after: always; } .grid { border: 2px solid #000; } }
  </style>
</head>
<body>
<aside>
  <div class="sb-header"><h2 class="sb-title" data-i18n="title">Jeu du Rideau</h2></div>
  <div class="sb-scroll">
    <div class="section">
        <label class="corr-toggle"><input type="checkbox" id="checkCorr" onchange="renderPages()"><span class="corr-text">üëÅÔ∏è CORRECTION</span></label>
    </div>
    <div class="section">
        <div class="sec-title" data-i18n="lang">Langue</div>
        <div class="flags"><div class="flag-btn active" onclick="setLang('fr', this)">FR</div><div class="flag-btn" onclick="setLang('en', this)">EN</div></div>
    </div>
    <div class="section">
      <div class="sec-title" data-i18n="layout">Mise en page</div>
      <select id="gridSize" onchange="startGen()">
          <option value="3x5" selected>15 cases (3x5)</option>
          <option value="3x4">12 cases (3x4)</option>
          <option value="2x4">8 cases (2x4)</option>
      </select>
    </div>
    <div class="section">
      <div class="sec-title" data-i18n="content">Contenu</div>
      <div class="control"><label data-i18n="target_lbl">Compl√©ments √†...</label>
      <select id="targetVal" onchange="startGen()"><option value="10" selected>10</option><option value="20">20</option><option value="100">100</option></select></div>
      <div class="control"><label data-i18n="order">Ordre</label>
      <select id="orderMode" onchange="toggleInputs(); startGen()"><option value="random" data-i18n="ord_random">Al√©atoire</option><option value="seq" data-i18n="ord_seq">S√©quentiel</option></select></div>
      <div id="seqInputs" class="control" style="display:none; gap:5px;"><input type="number" id="seqStart" value="0" style="width:100%" onchange="startGen()"><input type="number" id="seqEnd" value="10" style="width:100%" onchange="startGen()"></div>
      <div class="sec-title" style="margin-top:15px;" data-i18n="exercise">Exercice</div>
      <select id="gameMode" onchange="startGen()"><option value="complement" selected data-i18n="mode_comp">‚ùì Trouver le Compl√©ment</option><option value="eq" data-i18n="mode_eq">üßÆ √âquation Compl√®te</option><option value="color" data-i18n="mode_color">üé® Coloriage</option><option value="mix" data-i18n="mode_mix">M√©langer les types</option></select>
    </div>
    <div class="section">
       <div class="sec-title" data-i18n="bead_color">Couleur Billes</div>
       <select id="beadColor" onchange="renderPages()">
          <option value="red" data-i18n="opt_red">Rouge / Blanc</option>
          <option value="blue" data-i18n="opt_blue">Rouge / Bleu</option>
       </select>
    </div>
    <div class="actions"><button class="btn btn-new" onclick="startGen()" data-i18n="btn_mix">M√âLANGER</button><button class="btn btn-print" onclick="window.print()" data-i18n="btn_print">IMPRIMER</button></div>
  </div>
</aside>
<main id="mainArea"></main>
<script>
const i18n = {
    fr: { title: "Jeu du Rideau", lang: "Langue", layout: "Mise en page", grid: "Grille", content: "Contenu", target_lbl: "Compl√©ments √†...", order: "Ordre", ord_random: "Al√©atoire", ord_seq: "S√©quentiel", exercise: "Exercice", mode_comp: "‚ùì Trouver le Compl√©ment", mode_eq: "üßÆ √âquation Compl√®te", mode_color: "üé® Coloriage", mode_mix: "M√©langer les types", bead_color: "Couleur Billes", opt_red: "Rouge / Blanc", opt_blue: "Rouge / Bleu", btn_mix: "M√âLANGER", btn_print: "IMPRIMER" },
    en: { title: "Curtain Game", lang: "Language", layout: "Layout", grid: "Grid", content: "Content", target_lbl: "Complements to...", order: "Order", ord_random: "Random", ord_seq: "Sequential", exercise: "Exercise", mode_comp: "‚ùì Find Complement", mode_eq: "üßÆ Equation", mode_color: "üé® Coloring", mode_mix: "Mix Modes", bead_color: "Bead Color", opt_red: "Red / White", opt_blue: "Red / Blue", btn_mix: "SHUFFLE", btn_print: "PRINT" }
};
let currentLang = 'fr'; let state = [];
function setLang(l, el) { currentLang = l; document.querySelectorAll('.flag-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); updateUI(); startGen(); }
function updateUI() { const dict = i18n[currentLang]; document.querySelectorAll('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); if(dict[key]) el.innerText = dict[key]; }); }
function toggleInputs() { document.getElementById('seqInputs').style.display = document.getElementById('orderMode').value === 'seq' ? 'flex' : 'none'; }
function startGen() {
  const gridVal = document.getElementById('gridSize').value;
  const [cols, rows] = gridVal.split('x').map(Number);
  
  // Param√©trage des CSS variables pour le zoom auto
  document.documentElement.style.setProperty('--cols', cols);
  document.documentElement.style.setProperty('--rows', rows);

  const target = parseInt(document.getElementById('targetVal').value);
  const mode = document.getElementById('gameMode').value;
  state = [];
  if (document.getElementById('orderMode').value === 'seq') {
      let s = parseInt(document.getElementById('seqStart').value) || 0;
      let e = parseInt(document.getElementById('seqEnd').value) || target;
      for(let i=s; i<=e; i++) state.push(createItem(i, target, mode, i-s));
  } else {
      for(let i=0; i<(cols*rows); i++) state.push(createItem(Math.floor(Math.random()*(target+1)), target, mode, i));
  }
  renderPages();
}
function createItem(vis, target, mode, index) {
    let actualMode = mode;
    if (mode === 'mix') { const types = ['complement', 'eq', 'color']; actualMode = types[index % 3]; }
    let colorShowSide = Math.random() > 0.5 ? 'left' : 'right';
    return { vis, hidden: target - vis, target, mode: actualMode, colorShowSide };
}
function renderPages() {
  const main = document.getElementById('mainArea'); main.innerHTML = '';
  const isCorr = document.getElementById('checkCorr').checked;
  const theme = document.getElementById('beadColor').value;
  const [cols, rows] = document.getElementById('gridSize').value.split('x').map(Number);
  for (let i = 0; i < state.length; i += (cols*rows)) {
      const chunk = state.slice(i, i + (cols*rows));
      const page = document.createElement('div'); page.className = 'page';
      const inner = document.createElement('div'); inner.className = 'page-inner';
      const grid = document.createElement('div'); grid.className = 'grid';
      chunk.forEach(item => {
        const cell = document.createElement('div'); cell.className = 'cell';
        const top = document.createElement('div'); top.className = 'part-boulier';
        // Utilisation du moteur graphique avec le correctif "Target 10" et "Rideau forc√©"
        top.innerHTML = getSvg(item.vis, item.target, (item.mode === 'color'), theme);
        cell.appendChild(top);
        
        const bot = document.createElement('div'); bot.className = 'part-bottom';
        // CONFIGURATION CLASSIQUE : Grande case (Info) √† GAUCHE, Petite case (R√©ponse) √† DROITE
        const ans = document.createElement('div'); ans.className = 'box-ans';
        const info = document.createElement('div'); info.className = 'box-info';
        
        if (item.mode === 'complement') {
             info.innerHTML = `<span class="val-equation">${item.vis} + ${isCorr ? item.hidden : '&nbsp;&nbsp;'} = ${item.target}</span>`;
             if (isCorr) ans.innerHTML = `<span class="val-digit">${item.hidden}</span>`;
        } else if (item.mode === 'eq') {
             if (isCorr) info.innerHTML = `<span class="val-equation">${item.vis} + ${item.hidden} = ${item.target}</span>`;
             if (isCorr) ans.innerHTML = `<span class="val-digit">${item.hidden}</span>`;
        } else if (item.mode === 'color') {
             if (isCorr) {
                  info.innerHTML = `<span class="val-equation">${item.vis} + ${item.hidden} = ${item.target}</span>`;
                  ans.innerHTML = `<span class="val-digit">${item.hidden}</span>`;
             } else {
                  if (item.colorShowSide === 'left') {
                       info.innerHTML = `<span class="val-equation">${item.vis} + &nbsp;&nbsp;&nbsp; = ${item.target}</span>`;
                  } else {
                       ans.innerHTML = `<span class="val-digit">${item.hidden}</span>`;
                  }
             }
        }
        
        // ORDRE : Info (Gauche) -> Ans (Droite)
        bot.appendChild(info); 
        bot.appendChild(ans); 
        
        cell.appendChild(bot); grid.appendChild(cell);
      });
      inner.appendChild(grid); page.appendChild(inner); main.appendChild(page);
  }
}

function getSvg(vis, target, isColoringMode, theme) {
  const totalW = 300; 
  const frameW = 8;
  const midPt = totalW / 2;
  const innerW = totalW - (2 * frameW);
  const diameter = innerW / 21; 
  const r = (diameter / 2) - 0.1; 
  const dT = diameter; 

  let H, rows, spY, stY;

  if (target === 100) {
      rows = 10; spY = 15; stY = 15; H = 165;  
  } else if (target === 20) {
      rows = 2; spY = 18; stY = 16; H = 55;
  } else {
      rows = 1; spY = 0; stY = 17.5; H = 35; 
  }

  let svg = `<svg class="rr-svg" viewBox="0 0 ${totalW} ${H}">`;
  
  const brownColor = "#A07846";
  svg += `<rect x="0" y="0" width="${frameW}" height="${H}" fill="${brownColor}" />`;
  svg += `<rect x="${totalW - frameW}" y="0" width="${frameW}" height="${H}" fill="${brownColor}" />`;

  for(let row = 0; row < rows; row++) {
      let y = stY + (row * spY);
      svg += `<line x1="${frameW}" y1="${y}" x2="${totalW - frameW}" y2="${y}" stroke="#9ca3af" stroke-width="1.2" />`;
      
      let startX = frameW + r; 

      if (isColoringMode) {
          // Si Cible = 10 : Fil vide (on ne dessine RIEN, l'enfant dessine).
          // Si Cible != 10 (donc 20 ou 100) : On dessine les billes grises/blanches.
          if (target !== 10) {
              for(let i=0; i<10; i++) {
                  let fill = (i < 5) ? '#ccc' : '#fff'; 
                  if (target === 100 && row >= 5) fill = (i < 5) ? '#fff' : '#ccc';
                  svg += `<circle cx="${startX + i*dT}" cy="${y}" r="${r}" fill="${fill}" stroke="#333" stroke-width="0.8" />`;
              }
          }
      } else {
          let visOnRow = row < Math.floor(vis/10) ? 10 : (row === Math.floor(vis/10) ? vis%10 : 0);
          for(let i=0; i<visOnRow; i++) {
              let isF5 = (i < 5), inv = (target === 100 && row >= 5);
              let fill = inv ? (isF5 ? (theme === 'blue' ? '#2563eb' : '#ffffff') : '#dc2626') : (isF5 ? '#dc2626' : (theme === 'blue' ? '#2563eb' : '#ffffff'));
              svg += `<circle cx="${startX + i*dT}" cy="${y}" r="${r}" fill="${fill}" stroke="${(fill==='#fff'||fill==='#ffffff')?'#333':'none'}" stroke-width="0.8" />`;
          }
      }
  }
  
  // CORRECTION : Le rideau s'affiche SI (il y a des billes cach√©es) OU (on est en mode coloriage)
  // Cela garantit que pour 10+0 en coloriage, le rideau est pr√©sent.
  if (vis < target || isColoringMode) {
      svg += `<rect x="${midPt}" y="0" width="${totalW - frameW - midPt}" height="${H}" fill="#000" />`;
  }
  return svg + `</svg>`;
}
window.onload = () => { updateUI(); startGen(); };
</script>
</body>
</html>
