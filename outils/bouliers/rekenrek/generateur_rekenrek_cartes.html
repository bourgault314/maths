<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>G√©n√©rateur Rekenrek V25 - Final Clean</title>
    <style>
        /* ---------- CONFIGURATION ---------- */
        :root {
            --card-width: 95mm; 
            --card-height: 55mm; 
            --margin-top: 15mm;
            --gap-grid: 5mm; 
            --padding-left-base: calc((210mm - (2 * var(--card-width)) - var(--gap-grid)) / 2);
            --bead-size: 4.6mm; /* Taille standard */
            --wood-color: #C8AD7F; /* Couleur Carton/Bois recycl√© */
        }

        body.mode-airy { --bead-size: 3.8mm; /* Taille a√©r√©e */ }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f3f4f6;
            margin: 0; padding: 20px;
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact;
        }

        /* --- MENU PROPRE (GRID 3 COLONNES) --- */
        .settings-panel {
            max-width: 1100px; margin: 0 auto 30px auto; padding: 20px;
            background: white; border-radius: 8px; border: 1px solid #ccc;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 25px;
        }

        .settings-column {
            display: flex; flex-direction: column; gap: 15px;
            padding-right: 15px; border-right: 1px solid #eee;
        }
        .settings-column:last-child { border-right: none; padding-right: 0; }

        h3 {
            margin: 0 0 5px 0; font-size: 14px; text-transform: uppercase; 
            color: #2563eb; border-bottom: 2px solid #e5e7eb; padding-bottom: 5px;
            font-weight: 700;
        }

        /* Lignes d'inputs */
        .input-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 5px;}
        .row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        
        label { cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 14px; color: #333; }
        .label-title { font-weight: 600; font-size: 13px; color: #555; }
        
        /* Styles sp√©cifiques pour les groupes de boutons radio/check */
        .radio-group { display: flex; gap: 15px; background: #f9fafb; padding: 5px 10px; border-radius: 4px; border: 1px solid #e5e7eb; }

        input[type="number"] { padding: 6px; border: 1px solid #ccc; border-radius: 4px; width: 60px; }
        select { padding: 6px; border: 1px solid #ccc; border-radius: 4px; width: 100%; }
        input[type="checkbox"], input[type="radio"] { width: 16px; height: 16px; accent-color: #2563eb; cursor: pointer; }

        /* BOUTON IMPRIMER */
        .full-width { grid-column: 1 / -1; display: flex; justify-content: center; margin-top: 10px; }
        .btn-print {
            background-color: #16a34a; color: white; border: none; 
            padding: 15px 50px; border-radius: 6px; cursor: pointer; 
            font-weight: bold; font-size: 18px; 
            box-shadow: 0 4px 6px rgba(22, 163, 74, 0.3);
            transition: 0.2s;
        }
        .btn-print:hover { background-color: #15803d; transform: translateY(-1px); }

        /* --- ZONE IMPRESSION --- */
        #preview-area { display: flex; flex-direction: column; align-items: center; }

        .page-a4 {
            width: 210mm; height: 297mm;
            background: white;
            padding-top: var(--margin-top);
            padding-left: var(--padding-left-base);
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            position: relative; 
        }

        /* --- PAGE CARTES --- */
        .page-cards {
            display: grid;
            grid-template-columns: repeat(2, var(--card-width));
            grid-template-rows: repeat(4, var(--card-height));
            gap: var(--gap-grid);
            align-content: start;
        }

        /* --- PAGE PATRONS --- */
        .page-cache {
            display: flex; flex-direction: column; 
            align-items: center; justify-content: start;
            gap: 5mm; 
            padding-top: 15mm; padding-left: 0 !important;
        }

        /* SVG PATRON */
        .cut-line { stroke: #000; stroke-width: 1.5; fill: none; }
        .fold-line { stroke: #999; stroke-width: 1; stroke-dasharray: 4, 2; fill: none; }
        .glue-area { fill: #f9f9f9; stroke: #ccc; stroke-width: 1; stroke-dasharray: 2, 2; } 
        .face { fill: #fff; stroke: none; }
        .text-label { font-family: sans-serif; font-size: 10px; fill: #999; text-anchor: middle; dominant-baseline: middle; font-weight: bold; }
        .logo { font-family: 'Arial Black', sans-serif; font-weight: 900; font-size: 16px; fill: #ddd; text-anchor: middle; letter-spacing: 2px; dominant-baseline: middle; stroke:#ccc; stroke-width:1px; }

        /* --- CARTE REKENREK (RECTO) --- */
        .card {
            width: var(--card-width); height: var(--card-height);
            border: none; /* Pas de bordure grise */
            border-radius: 0; 
            box-sizing: border-box; overflow: hidden; break-inside: avoid;
            position: relative; 
        }

        .recto {
            /* Padding pour les montants */
            padding: 2mm 4mm; 
            display: flex; flex-direction: column;
            justify-content: space-evenly; height: 100%; box-sizing: border-box;
            position: relative; 
        }

        /* Les Montants en Bois (Pseudo-√©l√©ments) */
        .recto::before, .recto::after {
            content: '';
            position: absolute;
            top: 0; bottom: 0;
            width: 4mm;
            background-color: var(--wood-color);
            box-sizing: border-box;
            z-index: 10;
        }
        
        /* MONTANT GAUCHE : Arrondis externes √† gauche */
        .recto::before { 
            left: 0; 
            border-top-left-radius: 6px; 
            border-bottom-left-radius: 6px; 
        }
        
        /* MONTANT DROIT : Arrondis externes √† droite */
        .recto::after { 
            right: 0; 
            border-top-right-radius: 6px; 
            border-bottom-right-radius: 6px;
        }

        /* Option Contour Bois : Trait solide 1px */
        .recto.wood-outline::before { border: 1px solid #000; }
        .recto.wood-outline::after  { border: 1px solid #000; }

        /* Styles de fond */
        .recto.bg-white { background-color: #fff !important; }
        .recto.bg-black { background-color: #2d2d2d !important; }

        .rack-row { display: flex; align-items: center; height: 10%; position: relative; }
        
        /* Tiges */
        .recto.bg-white .wire { background: #6b7280 !important; } 
        .recto.bg-black .wire { background: #9ca3af !important; }
        .wire { position: absolute; left: 0; right: 0; top: 50%; height: 2px; z-index: 0; margin: 0 -1px; }
        
        .beads-container { display: flex; justify-content: space-between; width: 100%; height: 100%; z-index: 1; align-items: center; }
        .group-active, .group-inactive { display: flex; align-items: center; gap: 0; }
        
        /* Billes */
        .bead { 
            width: var(--bead-size); height: var(--bead-size); 
            margin: 0; border-radius: 50%; 
            box-sizing: border-box; 
            box-shadow: inset -2px -2px 4px rgba(0,0,0,0.2), inset 1px 1px 3px rgba(255,255,255,0.7), 1px 1px 1px rgba(0,0,0,0.2);
        }
        
        /* Contour billes : 1px */
        .bead.with-outline {
            border: 1px solid #000 !important; 
            box-shadow: inset -1px -1px 3px rgba(0,0,0,0.1), inset 1px 1px 2px rgba(255,255,255,0.5);
        }

        .bead.blue { background-color: #3b82f6 !important; } 
        .bead.red { background-color: #dc2626 !important; } 
        .bead.white { background-color: #f9fafb !important; } 

        /* VERSO */
        .verso { display: flex; flex-direction: column; background: white; border: 1px solid #ccc; border-radius: 4px; }
        .verso.theme-green { --theme-color: #10b981; }
        .verso.theme-blue  { --theme-color: #3b82f6; }
        .verso.theme-red   { --theme-color: #ef4444; }
        .verso.theme-black { --theme-color: #374151; }
        .verso-top { height: 55%; display: flex; border-bottom: 3px solid var(--theme-color) !important; }
        .tens-box { width: 50%; background-color: #fbbf24 !important; border-right: 3px solid var(--theme-color) !important; display: flex; justify-content: center; align-items: center; font-size: 32pt; font-weight: bold; font-family: 'Comic Sans MS', sans-serif; color: #000; }
        .units-box { width: 50%; background-color: white; display: flex; justify-content: center; align-items: center; font-size: 32pt; font-weight: bold; font-family: 'Comic Sans MS', sans-serif; color: #000; }
        .verso-middle { height: 30%; display: flex; justify-content: center; align-items: center; font-size: 13pt; font-family: 'Comic Sans MS', sans-serif; text-align: center; padding: 0 5px; }
        .verso-bottom { height: 15%; background-color: var(--theme-color) !important; }

        @media print {
            @page { size: A4; margin: 0; }
            body { padding: 0; background: none; }
            .settings-panel { display: none; }
            .page-a4 { margin: 0; box-shadow: none; page-break-after: always; }
            #preview-area { gap: 0; }
        }
    </style>
</head>
<body>

    <div class="settings-panel">
        
        <div class="settings-column">
            <h3>1. Configuration</h3>
            <div class="input-group">
                <span class="label-title">Plage de nombres :</span>
                <div class="row">
                    De <input type="number" id="min" value="0">
                    √Ä <input type="number" id="max" value="99" max="99">
                </div>
            </div>
            
            <div class="input-group">
                <span class="label-title">Fond du boulier :</span>
                <div class="row radio-group">
                    <label><input type="radio" name="bgStyle" value="white" checked> Blanc</label>
                    <label><input type="radio" name="bgStyle" value="black"> Noir</label>
                </div>
            </div>
            
             <div class="input-group">
                <label style="margin-top:5px;"><input type="checkbox" id="airyMode" checked> Mode A√©r√© (Billes + petites)</label>
            </div>
        </div>

        <div class="settings-column">
            <h3>2. Apparence & Couleurs</h3>
            
            <div class="input-group">
                <span class="label-title">Th√®me de couleur :</span>
                <div class="row radio-group">
                    <label><input type="radio" name="beadTheme" value="blue"> Rge/Bleu</label>
                    <label><input type="radio" name="beadTheme" value="white" checked> Rge/Blanc</label>
                </div>
            </div>

            <div class="input-group">
                <span class="label-title">Appliquer Contour Noir (Cercle) :</span>
                <div class="row radio-group">
                    <label><input type="checkbox" id="outlineRed" checked> Sur Rouges</label>
                    <label><input type="checkbox" id="outlineSec" checked> Sur 2√®me couleur</label>
                </div>
            </div>

            <div class="input-group">
                <!-- Option pour le contour bois -->
                <label style="margin-top:5px; font-weight:600; color:#555;">
                    <input type="checkbox" id="outlineWood" checked> 
                    Contour Montants (Bois)
                </label>
            </div>

            <div class="input-group">
                <span class="label-title">Langue (Verso) :</span>
                <select id="language">
                    <option value="fr">üá´üá∑ France</option>
                    <option value="be">üáßüá™ Belgique</option>
                    <option value="en">üá¨üáß English</option>
                </select>
            </div>
        </div>

        <div class="settings-column">
            <h3>3. Impression & Technique</h3>
            <div class="input-group">
                <label style="background:#e0f2fe; padding:8px; border-radius:6px;">
                    <input type="checkbox" id="printCards" checked> 
                    <strong>Cartes</strong>
                </label>
                <label style="background:#fef3c7; padding:8px; border-radius:6px;">
                    <input type="checkbox" id="printCache"> 
                    <strong>Patrons</strong>
                </label>
            </div>
            
            <div class="input-group">
                <span class="label-title">üìê Patron (mm) :</span>
                <div class="row">
                    L <input type="number" id="cacheWidth" value="97" style="width:50px">
                    H <input type="number" id="cacheHeight" value="35" style="width:50px">
                </div>
            </div>

            <div class="input-group">
                <span class="label-title">üñ®Ô∏è Calibrage (mm) :</span>
                <div class="row">
                    X <input type="number" id="offsetX" value="0" step="0.5" style="width:50px">
                    Y <input type="number" id="offsetY" value="0" step="0.5" style="width:50px">
                </div>
            </div>
        </div>

        <div class="full-width">
            <button class="btn-print" onclick="window.print()">üñ®Ô∏è LANCER L'IMPRESSION</button>
        </div>

    </div>

    <div id="preview-area"></div>

    <script>
        const unitsFR=["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"],teensFR=["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"],tensFR=["","dix","vingt","trente","quarante","cinquante","soixante","soixante-dix","quatre-vingt","quatre-vingt-dix"];
        const unitsEN=["","one","two","three","four","five","six","seven","eight","nine"],teensEN=["ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],tensEN=["","ten","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];

        function toFrench(n,be){if(n===0)return"z√©ro";let s="",d=Math.floor(n/10),u=n%10;if(n<10)return unitsFR[n];if(n>=10&&n<20)return teensFR[n-10];if(n>=20&&n<70){s=tensFR[d];if(u===1)s+="-et-un";else if(u>0)s+="-"+unitsFR[u];return s}if(n>=70&&n<80){if(be){s="septante";if(u===1)s+="-et-un";else if(u>0)s+="-"+unitsFR[u]}else{s="soixante";if(u===1)s+="-et-onze";else if(u===0)s+="-dix";else s+="-"+teensFR[u]}return s}if(n>=80&&n<90){s="quatre-vingt";if(u>0)s+="-"+unitsFR[u];else s+="s";return s}if(n>=90){if(be){s="nonante";if(u===1)s+="-et-un";else if(u>0)s+="-"+unitsFR[u]}else{s="quatre-vingt";if(u===0)s+="-dix";else s+="-"+teensFR[u]}return s}return s}
        function toEnglish(n){if(n===0)return"zero";let d=Math.floor(n/10),u=n%10;if(n<10)return unitsEN[n];if(n>=10&&n<20)return teensEN[n-10];let s=tensEN[d];if(u>0)s+="-"+unitsEN[u];return s}
        function numberToText(n,l){if(l==='en')return toEnglish(n);if(l==='be')return toFrench(n,true);return toFrench(n,false)}
        
        // Retourne 'red' ou 'secondary'
        function getBeadBaseColor(r,c){
            if(r<5) return c<5 ? 'red' : 'secondary';
            else return c<5 ? 'secondary' : 'red';
        }

        function createRecto(n, bgStyle, beadTheme, outlineRed, outlineSec, outlineWood){
            const c=document.createElement('div');
            
            // Classes : card + recto + bg
            let classes = `card recto bg-${bgStyle}`;
            if(outlineWood) classes += ' wood-outline';
            c.className = classes;
            
            // Plus de marqueurs de coupe ici.
            
            const full=Math.floor(n/10),rem=n%10;
            const secondaryColor = beadTheme; // 'blue' or 'white'

            for(let i=0;i<10;i++){
                const r=document.createElement('div');r.className='rack-row';
                r.innerHTML='<div class="wire"></div>';
                const ct=document.createElement('div');ct.className='beads-container';
                const ga=document.createElement('div');ga.className='group-active';
                const gi=document.createElement('div');gi.className='group-inactive';
                
                let ac=(i<full)?10:(i===full?rem:0);
                
                for(let j=0;j<10;j++){
                    const b=document.createElement('div');
                    
                    const baseType = getBeadBaseColor(i, j); // 'red' or 'secondary'
                    
                    let finalColor = (baseType === 'red') ? 'red' : secondaryColor;
                    let finalClass = `bead ${finalColor}`;
                    
                    // Gestion Contours Billes
                    let needsOutline = false;
                    if(baseType === 'red' && outlineRed) needsOutline = true;
                    if(baseType === 'secondary' && outlineSec) needsOutline = true;
                    
                    if(needsOutline) finalClass += ' with-outline';
                    
                    b.className = finalClass;
                    
                    if(j<ac)ga.appendChild(b);else gi.appendChild(b);
                }
                ct.appendChild(ga);ct.appendChild(gi);r.appendChild(ct);c.appendChild(r);
            }
            return c;
        }

        function createVerso(n,l){
            const c=document.createElement('div');
            const t=Math.floor(n/10),u=n%10;
            let th=(n<=9)?'green':(n<=29)?'blue':(n<=69)?'red':'black';
            c.className=`card verso theme-${th}`;
            c.innerHTML=`<div class="verso-top"><div class="tens-box">${t}</div><div class="units-box">${u}</div></div><div class="verso-middle"><span>${numberToText(n,l)}</span></div><div class="verso-bottom"></div>`;
            return c;
        }

        // --- PATRON V12 (DYNAMIQUE) ---
        function getPochetteSVG(w, h) {
            const w_rabat = 15;
            const totalW = w + (2 * w_rabat);
            const totalH = h * 2;
            
            return `
            <svg width="${totalW}mm" height="${totalH}mm" viewBox="-${w_rabat} 0 ${totalW} ${totalH}" xmlns="http://www.w3.org/2000/svg">
                <g>
                    <rect x="0" y="0" width="${w}" height="${h}" class="face" stroke="black" stroke-width="0.5"/>
                    <rect x="-${w_rabat}" y="0" width="${w_rabat}" height="${h}" class="glue-area" />
                    <line x1="0" y1="0" x2="0" y2="${h}" class="fold-line" />
                    <text x="-${w_rabat/2}" y="${h/2}" class="text-label" transform="rotate(-90, -${w_rabat/2}, ${h/2})">COLLE</text>
                    <rect x="${w}" y="0" width="${w_rabat}" height="${h}" class="glue-area" />
                    <line x1="${w}" y1="0" x2="${w}" y2="${h}" class="fold-line" />
                    <text x="${w + w_rabat/2}" y="${h/2}" class="text-label" transform="rotate(90, ${w + w_rabat/2}, ${h/2})">COLLE</text>
                    <line x1="0" y1="${h}" x2="${w}" y2="${h}" class="fold-line" />
                    <rect x="0" y="${h}" width="${w}" height="${h}" class="face" stroke="black" stroke-width="0.5"/>
                    <text x="${w/2}" y="${h * 1.5}" class="logo">CACHE</text>
                    <path d="M -${w_rabat},0 L ${w + w_rabat},0 L ${w + w_rabat},${h} L ${w},${h} L ${w},${h*2} L 0,${h*2} L 0,${h} L -${w_rabat},${h} Z" class="cut-line" />
                </g>
            </svg>`;
        }

        function createCachePage(w, h){
            const p=document.createElement('div');p.className='page-a4 page-cache';
            const totalH = (h*2) + 5; 
            const count = Math.floor(260 / totalH); 
            for(let i=0;i<count;i++){
                const div=document.createElement('div');
                div.innerHTML=getPochetteSVG(w, h);
                p.appendChild(div);
            }
            return p;
        }

        function generate(){
            const area=document.getElementById('preview-area');area.innerHTML='';
            
            // Gestion min/max (max 99)
            let minInput = document.getElementById('min');
            let maxInput = document.getElementById('max');
            
            // For√ßage de la limite visuelle si l'utilisateur tape manuellement plus que 99
            if (parseInt(maxInput.value) > 99) maxInput.value = 99;
            
            let min=parseInt(minInput.value)||0;
            let max=parseInt(maxInput.value)||0;

            if(min>max)[min,max]=[max,min];
            
            // R√©cup√©ration des nouveaux param√®tres granulaires
            const bgStyle = document.querySelector('input[name="bgStyle"]:checked').value;
            const beadTheme = document.querySelector('input[name="beadTheme"]:checked').value;
            const outlineRed = document.getElementById('outlineRed').checked;
            const outlineSec = document.getElementById('outlineSec').checked;
            const outlineWood = document.getElementById('outlineWood').checked; // Nouveau

            const lang=document.getElementById('language').value;
            const airy=document.getElementById('airyMode').checked;
            
            const doCards = document.getElementById('printCards').checked;
            const doCache = document.getElementById('printCache').checked;
            const cacheW = parseInt(document.getElementById('cacheWidth').value)||97;
            const cacheH = parseInt(document.getElementById('cacheHeight').value)||35;
            
            const offX=document.getElementById('offsetX').value,offY=document.getElementById('offsetY').value;

            if(airy)document.body.classList.add('mode-airy');else document.body.classList.remove('mode-airy');

            if (doCache) area.appendChild(createCachePage(cacheW, cacheH));

            if (doCards) {
                const nums=[];for(let i=min;i<=max;i++)nums.push(i);
                const perPage=8; const map=[1,0,3,2,5,4,7,6];

                for(let i=0;i<nums.length;i+=perPage){
                    const chunk=nums.slice(i,i+perPage);
                    // Recto
                    const pR=document.createElement('div');pR.className='page-a4 page-cards';
                    // On passe tous les arguments n√©cessaires √† createRecto
                    chunk.forEach(n=>pR.appendChild(createRecto(n, bgStyle, beadTheme, outlineRed, outlineSec, outlineWood)));
                    area.appendChild(pR);
                    // Verso
                    const pV=document.createElement('div');pV.className='page-a4 page-cards';
                    pV.style.paddingLeft=`calc(var(--padding-left-base) + ${offX}mm)`;
                    pV.style.paddingTop=`calc(var(--margin-top) + ${offY}mm)`;
                    for(let j=0;j<perPage;j++){
                        const idx=map[j];
                        if(idx<chunk.length && chunk[idx]!==undefined) pV.appendChild(createVerso(chunk[idx],lang));
                        else{const e=document.createElement('div');e.className='card';e.style.border='none';pV.appendChild(e);}
                    }
                    area.appendChild(pV);
                }
            }
        }

        window.onload=function(){
            generate();
            // √âcoute des changements sur tous les inputs (y compris radios et checkbox)
            document.querySelectorAll('input,select').forEach(e=>e.addEventListener('input',generate));
        };
    </script>
</body>
</html>
