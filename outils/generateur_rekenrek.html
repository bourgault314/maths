<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Générateur Rekenrek</title>
    <style>
        /* ---------- CONFIGURATION ---------- */
        :root {
            /* Largeur 95mm */
            --card-width: 95mm; 
            --card-height: 55mm; 
            
            /* Marges ajustées pour 8 cartes */
            --margin-top: 15mm;
            --gap-grid: 5mm; 
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #e5e7eb;
            margin: 0;
            padding: 20px;
            -webkit-print-color-adjust: exact; 
            print-color-adjust: exact;
        }

        /* Interface */
        .settings-panel {
            max-width: 900px; margin: 0 auto 20px auto; padding: 20px;
            background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex; flex-wrap: wrap; align-items: center; gap: 15px;
        }

        .settings-panel h2 {
            width: 100%; margin: 0 0 10px 0; padding-bottom: 10px;
            border-bottom: 1px solid #eee; font-size: 1.5rem; color: #333;
        }

        .input-group { display: flex; align-items: center; gap: 10px; }
        
        button {
            background-color: #2563eb; color: white; border: none; padding: 10px 20px;
            border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 16px; margin-left: auto;
        }
        button:hover { background-color: #1d4ed8; }
        
        input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 70px; font-size: 16px;}
        label { font-weight: 500; color: #555; }

        /* Zone d'impression */
        #preview-area {
            display: flex; flex-direction: column; align-items: center;
        }

        .page-a4 {
            width: 210mm; height: 297mm;
            background: white;
            padding-top: var(--margin-top);
            padding-left: calc((210mm - (2 * var(--card-width)) - var(--gap-grid)) / 2);
            box-sizing: border-box;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            
            /* Grille FIXE 2 colonnes x 4 lignes = 8 cartes */
            display: grid;
            grid-template-columns: repeat(2, var(--card-width));
            grid-template-rows: repeat(4, var(--card-height));
            gap: var(--gap-grid);
            align-content: start;
        }

        /* CARTE */
        .card {
            width: var(--card-width);
            height: var(--card-height);
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box;
            overflow: hidden;
            position: relative;
            break-inside: avoid;
        }

        /* RECTO (BOULIER) */
        .recto {
            background-color: #111 !important; 
            border-left: 7mm solid #d2b48c;  
            border-right: 7mm solid #d2b48c; 
            padding: 2mm 0; 
            display: flex;
            flex-direction: column;
            justify-content: space-evenly; 
            height: 100%;
            box-sizing: border-box; 
        }

        .rack-row {
            display: flex;
            align-items: center;
            height: 10%; 
            position: relative;
            padding: 0; 
        }

        .wire {
            position: absolute; left: 0; right: 0; top: 50%;
            height: 2px;
            background: #9ca3af !important; 
            z-index: 0;
            margin: 0 -1px; 
        }

        .beads-container {
            display: flex;
            justify-content: space-between; 
            width: 100%; height: 100%;
            z-index: 1; align-items: center;
        }

        .group-active, .group-inactive { display: flex; align-items: center; }
        
        .bead {
            /* TAILLE 4mm (Parfait pour 8 cartes/page) */
            width: 4mm; height: 4mm; 
            border-radius: 50%; 
            margin: 0; 
            /* Style réaliste */
            box-shadow: inset -1px -1px 2px rgba(0,0,0,0.6), 1px 1px 2px rgba(255,255,255,0.3);
        }

        .bead.blue { background-color: #3b82f6 !important; } 
        .bead.red { background-color: #dc2626 !important; }  

        /* VERSO (NOMBRE) */
        .verso {
            display: flex; flex-direction: column;
            background: white; 
            border: 1px solid #ccc; 
        }

        /* COULEURS THÈMES */
        .verso.theme-green { --theme-color: #10b981; }
        .verso.theme-blue  { --theme-color: #3b82f6; }
        .verso.theme-red   { --theme-color: #ef4444; }
        .verso.theme-black { --theme-color: #1f2937; }

        .verso-top {
            height: 55%; display: flex; 
            border-bottom: 3px solid var(--theme-color) !important;
        }
        
        .tens-box {
            width: 50%; 
            background-color: #fbbf24 !important; 
            border-right: 3px solid var(--theme-color) !important;
            display: flex; justify-content: center; align-items: center;
            font-size: 32pt; font-weight: bold; font-family: 'Comic Sans MS', sans-serif; color: #000;
        }
        
        .units-box {
            width: 50%; background-color: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 32pt; font-weight: bold; font-family: 'Comic Sans MS', sans-serif; color: #000;
        }
        
        .verso-middle {
            height: 30%; display: flex; justify-content: center; align-items: center;
            font-size: 14pt; font-family: 'Comic Sans MS', sans-serif; text-align: center;
        }
        
        .verso-bottom { 
            height: 15%; 
            background-color: var(--theme-color) !important;
        }

        /* STYLES IMPRESSION */
        @media print {
            @page { size: A4; margin: 0; }
            body { 
                padding: 0; background: none;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            .settings-panel { display: none; }
            .page-a4 { 
                margin: 0; box-shadow: none; page-break-after: always; 
                width: 210mm; height: 297mm;
            }
            #preview-area { gap: 0; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>

    <div class="settings-panel">
        <h2>Générateur Rekenrek</h2>
        
        <div class="input-group">
            <label>De : <input type="number" id="min" value="0"></label>
            <label>À : <input type="number" id="max" value="99"></label>
        </div>
        
        <button onclick="generate()">Générer les cartes</button>
        <button onclick="window.print()" style="background-color: #059669;">Imprimer</button>
    </div>

    <div id="preview-area"></div>

    <script>
        function numberToText(n) {
            const u = ["", "un", "deux", "trois", "quatre", "cinq", "six", "sept", "huit", "neuf"];
            const teens = ["dix", "onze", "douze", "treize", "quatorze", "quinze", "seize", "dix-sept", "dix-huit", "dix-neuf"];
            const tens = ["", "dix", "vingt", "trente", "quarante", "cinquante", "soixante", "soixante-dix", "quatre-vingt", "quatre-vingt-dix"];
            if (n === 0) return "zéro";
            
            let str = "";
            let d = Math.floor(n/10);
            let unit = n % 10;

            if (n < 10) return u[n];
            if (n >= 10 && n < 20) return teens[n-10];
            
            if (n >= 20 && n < 70) {
                str = tens[d];
                if (unit === 1) str += "-et-un";
                else if (unit > 0) str += "-" + u[unit];
                return str;
            }
            if (n >= 70 && n < 80) {
                str = "soixante";
                if (unit === 1) str += "-et-onze";
                else if (unit === 0) str += "-dix";
                else str += "-" + teens[unit];
                return str;
            }
            if (n >= 80 && n < 90) {
                str = "quatre-vingt";
                if (unit > 0) str += "-" + u[unit];
                else str += "s";
                return str;
            }
            if (n >= 90) {
                str = "quatre-vingt";
                if (unit === 0) str += "-dix";
                else str += "-" + teens[unit];
                return str;
            }
            return str;
        }

        function getBeadColorClass(rowIndex, beadIndex) {
            if (rowIndex < 5) return beadIndex < 5 ? 'blue' : 'red';
            else return beadIndex < 5 ? 'red' : 'blue';
        }

        function createBead(colorClass) {
            const b = document.createElement('div');
            b.className = `bead ${colorClass}`;
            return b;
        }

        function createRecto(n) {
            const card = document.createElement('div');
            card.className = 'card recto';

            const fullRows = Math.floor(n / 10);
            const remainder = n % 10;

            for (let i = 0; i < 10; i++) {
                const row = document.createElement('div');
                row.className = 'rack-row';
                
                const wire = document.createElement('div');
                wire.className = 'wire';
                row.appendChild(wire);

                const container = document.createElement('div');
                container.className = 'beads-container';

                const groupActive = document.createElement('div');
                groupActive.className = 'group-active';
                const groupInactive = document.createElement('div');
                groupInactive.className = 'group-inactive';

                let activeCount = 0;
                if (i < fullRows) activeCount = 10;
                else if (i === fullRows) activeCount = remainder;

                for (let j = 0; j < 10; j++) {
                    const color = getBeadColorClass(i, j);
                    // Création correcte de l'élément perle
                    const bead = document.createElement('div');
                    bead.className = `bead ${color}`;

                    if (j < activeCount) groupActive.appendChild(bead);
                    else groupInactive.appendChild(bead);
                }
                container.appendChild(groupActive);
                container.appendChild(groupInactive);
                row.appendChild(container);
                card.appendChild(row);
            }
            return card;
        }

        function createVerso(n) {
            const card = document.createElement('div');
            const tens = Math.floor(n / 10);
            const units = n % 10;
            const text = numberToText(n);

            let themeClass = 'theme-black';
            if (n <= 9) themeClass = 'theme-green';
            else if (n >= 10 && n <= 29) themeClass = 'theme-blue';
            else if (n >= 30 && n <= 69) themeClass = 'theme-red';
            else if (n >= 70) themeClass = 'theme-black';
            
            card.className = `card verso ${themeClass}`;
            card.innerHTML = `
                <div class="verso-top">
                    <div class="tens-box">${tens}</div>
                    <div class="units-box">${units}</div>
                </div>
                <div class="verso-middle"><span>${text}</span></div>
                <div class="verso-bottom"></div>
            `;
            return card;
        }

        function generate() {
            const container = document.getElementById('preview-area');
            container.innerHTML = '';
            
            let min = parseInt(document.getElementById('min').value);
            let max = parseInt(document.getElementById('max').value);
            if(min > max) [min, max] = [max, min];

            const allNumbers = [];
            for(let i=min; i<=max; i++) allNumbers.push(i);

            // FIXE : 8 cartes par page
            const cardsPerPage = 8; 
            const cols = 2; 
            const versoMap = [1, 0, 3, 2, 5, 4, 7, 6];

            for(let i=0; i<allNumbers.length; i+=cardsPerPage) {
                const chunk = allNumbers.slice(i, i+cardsPerPage);

                // Page Recto
                const pageR = document.createElement('div');
                pageR.className = 'page-a4';
                chunk.forEach(num => pageR.appendChild(createRecto(num)));
                container.appendChild(pageR);

                // Page Verso
                const pageV = document.createElement('div');
                pageV.className = 'page-a4';
                for(let j=0; j<cardsPerPage; j++) {
                    const targetIndex = versoMap[j];
                    if(targetIndex < chunk.length && chunk[targetIndex] !== undefined) {
                        pageV.appendChild(createVerso(chunk[targetIndex]));
                    } else if (j < cardsPerPage) {
                        const empty = document.createElement('div');
                        empty.className = 'card';
                        empty.style.border = 'none';
                        pageV.appendChild(empty);
                    }
                }
                container.appendChild(pageV);
            }
        }

        window.onload = generate;
    </script>
</body>
</html>
